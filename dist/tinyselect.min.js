/**
 * TinySelect 0.4.2 2018-05-22
 * @作者: hyjiacan
 * @源码: https://gitee.com/hyjiacan/TinySelect.git
 * @示例: http://hyjiacan.oschina.io/tinyselect
 * @许可协议: MIT
 * @依赖: jQuery 1.8.0及更高版本
 * @浏览器支持: 不支持IE8及更低版本
 * @QQ群: 187786345 (Javascript爱好者)
 */

!function(a,b){"use strict";function c(a){this.selector=[],this.css(a)}function d(a,c,e){var f=b(a).get(0);if(f){for(var g,h=0;h<Y.length;h++)if(g=Y[h],g.source.get(0)===f)return g;return g=new d.fn.init(f,c,e),Y.push(g),g}}function e(a,c){var d=b("<div>"),e=a.option,f=e.result,g=c.get(0);if(Object.defineProperty(a,"fromSelect",{writabke:ca,configurable:ca,value:ba}),!f||!f.style&&!f.css){var h=c.height();b.each(["padding","margin","box-sizing","color","background","background-color","font","border","lineHeight","top","right","bottom","left"],function(a,b){d.css(b,c.css(b))});var i=S(c,"position"),j=T(c);d.css({position:/^static$/.test(i)?"relative":i,width:c.width(),height:h,lineHeight:h-j.top-j.bottom+"px"})}f.multi=g.hasAttribute("multiple");var k=[],l=[],m=ca;return c.find("option").each(function(){var a=b(this),c=a.parent(),d=a.val(),e={id:d,text:a.text()};c.is("optgroup")&&(m=ba,e.group=c.attr("label")),k.push(e),a.is(":selected")&&l.push(d)}),m&&(e.group.valueField="group"),e.item.data=k,l.length&&(e.item.value=l),(g.hasAttribute("readonly")||c.is(":disabled"))&&(e.readonly=ba),c.hide(),c.after(d),d}function f(a){var b=a.option,c=a.context,d=b.result,e=aa(b.tabindex);if(e=b.tabindex=isNaN(e)||e<0?ca:e,e!==ca&&c.attr("tabindex",e),c.addClass(fa),b.readonly&&c.addClass(ka),d.css&&c.addClass(d.css),d.style&&c.css(d.style),b.mode!==Va){c.append(a.placeholder=cb(ha).html(b.result.placeholder)),c.append(cb(ia));var f=d.arrow;f===ca||f===da&&d.multi||(c.addClass(ga).append(cb(ja)),/static/i.test(S(c,"position"))&&c.css("position","relative"))}}function g(a){var c=a.option,d=a.context,e=a.dom=cb(la).addClass("{0}-mode-{0}".fill(ea,c.mode)),f=c.tabindex;switch(f!==ca&&e.attr("tabindex",f),c.mode){case Va:c.style.width=d.siblings(":visible").length?d.width():"auto",c.style.height=d.height()||"auto";var g=S(d,"position");c.style.position=/static/i.test(g)?"relative":g,d.append(e);break;case Ua:b(Z.body).append(e);break;case Wa:b(Z.body).append((a.mask=cb(ma)).append(e))}e.addClass(c.css).css(c.style).append(h(a,c));var i=c.box,k=a.box=cb(wa).addClass("{0}-layout-{0}".fill(wa,i.layout)).addClass(i.css).css(i.style);i.layout===Ya&&k.append(cb(na)),e.append(k),e.append(j(a,c))}function h(a,b){var c=b.header,d=a.header=cb(qa).addClass(c.css).css(c.style).append(i(a,b));return c.render&&c.render.call(d,b.item.data),d}function i(c,d){var e=d.header.filter,f=b('<input type="text"  placeholder="{0}" class="{0}" />'.fill(e.placeholder,Ea)).addClass(e.css).css(e.style);return f.keyup(function(d){var g=f.val();X&&(a.clearTimeout(X),X=0),(/^change$/i.test(e.trigger)?""===b.trim(String.fromCharCode(d.keyCode||d.which))||f.data("last")!==g:13===d.keyCode)&&(f.data("last",g),X=_(function(){c.filter(g,ba)},e.delay))}),f}function j(a,b){var c=b.footer,d=a.footer=cb(ra).addClass(c.css).css(c.style),e=cb(sa),f=cb(ta);return f.append(cb(ua,Sa).html(c.totalTpl.replace(Qa,0))),d.append(e).append(f),b.result.multi&&k(a,b,e,f),c.render&&c.render.call(d,b.data),d}function k(a,c,d,e){var f=b(Ta);d.append(b("<label>").append(f).append("全选")),f.change(function(){var c=f.is(":checked");K(a,Ra).each(function(d,e){if(e=b(e),c){if(e.hasClass(Ca))return;return void G(a,e,ba)}e.hasClass(Ca)&&H(a,e,ba)})});var g=cb(va,Sa);M(c,g),e.prepend(g)}function l(a,c){var d=c.valueField,e=c.textField||d,f=[{_group_item_:ba,text:c.unknown,id:0}],g={},h=0;b.each(a,function(){var a=this,b=_a(a,d),c=_a(a,e);if(!b)return a._group_id_=0,void f.push(a);var i=a[d],j=c?a[e]:"";_a(g,i)||(g[i]={id:++h,text:j,data:[]}),a._group_id_=h,g[i].data.push(a)});var i=[];return b.each(g,function(a,b){i.push({id:b.id,_group_item_:ba,key:a,text:b.text}),db(i,b.data)}),f.length>1&&db(i,f),i}function m(a,b){var d=a.box,e=a.option,f=e.item,g=f.data,h=e.group,i=aa(f.visible);(isNaN(i)||i<0)&&(i=0);var j=g?g.length:0;d.height("auto"),e.box.layout===Ya?d.find(c.build(na).first()).empty():d.empty(),a.fromSelect&&a.source.empty(),E(a),a.dom.removeClass(pa);var k=I(a);if(P(k,j),L(e,k),!j)return d.append(e.box.empty),a.dom.addClass(pa),void(b&&b.call(a,g));h.valueField&&(g=l(g,h),j=g.length);var m=n(a,d,f,g,b,0,i);if(isNaN(aa(a.dom.get(0).style.height))){if(0===i||i>=j)return;V(a);var o=R(m).height;W(a);var p=0;if(h.valueField){var q=d.find(c.build(xa));p=q.first().height()*q.length}d.height(i*o+p)}else{var r=a.dom.height();if(a.header.is(Ra)&&(r-=R(a.header).height),a.footer.is(Ra)&&(r-=R(a.footer).height),d.height(r),0===i||i>=j)return}f.async?ab(n,[a,d,f,g,b,i]):n(a,d,f,g,b,0)}function n(a,b,d,e,f,g,h){var i;a.option.box.layout===Ya&&(b=b.find(c.build(na).first()));var j=a.fromSelect,k=a.source,l=a.option.group,m=d.data;if(h=h||e.length-g,!(g>=e.length)){var n=g+h;n>e.length&&(n=e.length);for(var o,p=l.valueField,q=g;q<n;q++){var r=e[q];if(p&&r._group_item_){var s=cb(xa).addClass(l.css).css(l.style).html(r.text).attr(Pa,r.id);l.render&&s.append(l.render.call(a,s,r)),b.append(s),o=da,j&&k.append(cb("","optgroup").text(r.text).attr("value",r.id))}else{o||(o=cb(oa),b.append(o));var t=P(cb(ya),r),u=cb(za),v=cb(Aa),w=cb(Ba);t.addClass(d.css).css(d.style).append(u).append(v).append(w),v.append(d.render?d.render.call(t,r,q,m):r[d.textField]),t.attr(Oa,q),p&&t.attr(Pa,r._group_id_),o.append(t),i||(i=t),j&&k.append(cb("","option").text(r.text).attr("value",r.id))}}return n!==e.length?i:(d.value&&a.value(d.value),f&&f.call(a,m),i)}}function o(c){c.option.mode!==Va&&(p(c),s(c)),t(c),u(c),c.option.keyboard&&v(c),b(a).resize(function(){c.dom.is(Ra)&&(q(c.context,c.dom,c.option),r(c))})}function p(a){a.context.on("click focus",function(){a.option.readonly||a.dom.is(Ra)||a.show()})}function q(c,d,e){var f=c.offset(),g=e.mode,h=d.height(),i=b(a).height(),j=R(c),k=j.height,l=j.width;g===Ua?(i-f.top-k<h?f.top=f.top-h-2:f.top=f.top+k+2,d.css({left:f.left,top:f.top,width:e.style.width||l})):g===Wa&&d.parent().css({paddingTop:(i-h)/3,paddingLeft:(b(a).width()-d.width())/2})}function r(a){var b=a.dom;if("100%"!==b.get(0).style.height){var c=b.parent().height();if(c>0&&(a.option.mode===Va||b.height()>=c)){var d=U(b);b.height(c-d.top-d.bottom)}}var e=b.get(0).style.height;e&&!/auto/i.test(e)&&a.box.height(b.height()-8-(a.header.is(Ra)?a.header.height():0)-(a.footer.is(Ra)?a.footer.height():0))}function s(c){var d=c.context,e=c.dom;b(a).click(function(a){var b=a.target;d.is(b)||e.is(b)||d.find(b).length||e.find(b).length||e.is(Ra)&&c.hide()})}function t(a){a.box.on("click",c.build(ya).done(),function(){var c=b(this);F(a,c,ba,ba),a.fromSelect&&a.option.result.sync&&a.source.val(a.value()),a.option.result.multi||a.hide()})}function u(a){var b=a.context.find(c.build(ia).first()),d=J(a),e=a.option,f=e.result,g=f.multi,h=f.render;a.on(Ia,function(c){var f=c.data[e.item.textField];if(f=h?h.call(c.target,c.data):f,!g)return void b.html(f);if(e.mode!==Va){var i=z(a,f,c.index);b.append(i),b.stop().animate({scrollTop:b[0].scrollHeight})}P(d,(O(d)||0)+1),M(e,d)}),g&&a.on(Ja,function(a){b.find(c.build(Fa).attr(Oa,a.index).first()).remove();var f=O(d);P(d,f>0?f-1:0),M(e,d)})}function v(d){b(a).keydown(function(a){if(d.dom.is(Ra)){var b,e=d.box.find(c.build(Da).first());switch(a.keyCode||a.which){case 40:b=x(d,e);break;case 38:b=w(d,e);break;case 32:case 13:return void e.click();case 27:return void d.hide();default:return}b.length||(b=e),d.header.find("."+Ea).blur(),b.focus(),e.removeClass(Da),b.addClass(Da),y(b)}}),d.dom.on("mouseover",c.build(ya).done(),function(){d.box.find("."+Da).removeClass(Da),b(this).addClass(Da)})}function w(a,b){if(0===b.length)return K(a).eq(0);var d=b.prev();return d.length||(d=b.parent().prevAll(c.build(oa).first()).find(c.build(ya).last())),d}function x(a,b){if(0===b.length)return K(a).eq(0);var d=b.next();return d.length||(d=b.parent().nextAll(c.build(oa).first()).find(c.build(ya).first())),d}function y(a){var b=a.parent().parent();/auto/i.test(S(b,"overflowY"))||(b=b.parent()),b.stop().animate({scrollTop:a.offset().top-b.offset().top+b.scrollTop()-R(a).height},100)}function z(a,b,d){if(a.option.mode!==Va)return cb(Fa).css(a.option.result.style).attr(Oa,d).append(cb(Ga,Sa).html(b)).append(cb(Ha,Sa).click(function(){if(!a.option.readonly)return H(a,K(a,c.build().attr(Oa,d).first()),ba),ca}))}function A(a,b,c){return B(a,b,{target:c.get(0),data:O(c),index:c.attr(Oa)})}function B(a,b,c){if(_a(a.events,b)){c.type=b;for(var d=a.events[b],e=d.length-1;e>=0;e--)if(d[e].call(a,c)===ca)return ca}}function C(a){var d=a.option,e=d.item.valueField;if(!d.result.multi){var f=K(a,c.build(Ca).first());return 0===f.length?void 0:O(f)[e]}return b.makeArray(K(a,c.build(Ca).done()).map(function(a,c){return O(b(c))[e]}))}function D(a,c,d){for(var e,f=a.option,g=f.result.multi,h=b.makeArray(c),i=0,j=K(a);i<j.length;i++){e=b(j[i]);if(-1!==h.indexOf(O(e)[f.item.valueField])){if(F(a,e,ca,d),!g)return}else g&&H(a,e,d)}}function E(a){var d=K(a);if(a.context.find(c.build(ia).first()).empty(),a.option.result.multi)return void d.filter(c.build(Ca).done()).each(function(c,d){H(a,b(d),ba)});var e=d.filter(c.build(Ca).first());e.length&&H(a,e,ba)}function F(a,b,d,e){var f=a.option.result.multi,g=b.hasClass(Ca);if(!f){if(g)return;var h=a.box.find(c.build(Ca).done()).not(b).first();return h.length&&H(a,h,e),void G(a,b,e)}if(!g)return void G(a,b,e);d&&H(a,b,e)}function G(a,b,c){c&&A(a,Ia,b)===ca||(b.addClass(Ca),a.option.mode!==Va&&a.placeholder.hide())}function H(a,b,c){var d=a.option;c&&A(a,Ja,b)===ca||(b.removeClass(Ca),d.mode!==Va&&(d.result.multi?0===a.value().length:void 0===a.value())&&a.placeholder.show())}function I(a){return a.footer.find(c.build(ta).sub(ua).done())}function J(a){return a.footer.find(c.build(ta).sub(va).done())}function K(a,b){return a.box.find(c.build(ya).addon(b).done())}function L(a,b){N(b,a.footer.totalTpl)}function M(a,b){N(b,a.footer.selectedTpl)}function N(a,b){a.html(b.replace(Qa,O(a)||0))}function O(a,b){return a.data(b||La)}function P(a,b,c){return a.data(c||La,b)}function Q(a,b,d){var e=a.filter(c.build().attr(Pa,d).done());0===b.filter(c.build().attr(Pa,d).visible()).length?e.hide():e.show()}function R(a){var b=a.width(),c=a.height(),d=T(a);return/^border-box$/i.test(S(a,"box-sizing"))&&(c+=d.top+d.bottom+aa(S(a,"border-top-width"))+aa(S(a,"border-bottom-width")),b+=d.left+d.right+aa(S(a,"border-left-width"))+aa(S(a,"border-right-width"))),{width:b,height:c}}function S(a,b){return a.css(b)}function T(a){return{top:aa(S(a,"padding-top"))||0,right:aa(S(a,"padding-right"))||0,bottom:aa(S(a,"padding-bottom"))||0,left:aa(S(a,"padding-left"))||0}}function U(a){return{top:aa(S(a,"border-top"))||0,right:aa(S(a,"border-right"))||0,bottom:aa(S(a,"border-bottom"))||0,left:aa(S(a,"border-left"))||0}}function V(a){P(a.dom,S(a.dom,Ma),Ma),a.dom.css({display:"block",visibility:"hidden"})}function W(a){a.dom.css({display:O(a.dom,Ma)||"none",visibility:Na})}String.prototype.fill=function(){var a=[].slice.apply(arguments);return this.replace(/{([0-9]+)(\/.[lLrR]?)?}/g,function(b,c,d){var e=a.length?a.shift():"";if(e=null===e||void 0===e?"":String(e).toString(),0===c)return e;var f=c-e.length;if(f<=0)return e;for(var g=d[1],h=d[2]||"l",i="",j=0;j<f;j++)i+=g;return/r/i.test(h)?e+=i:e=i+e,e})};var X,Y=[],Z=a.document,$=a.console,_=a.setTimeout,aa=a.parseInt,ba=!0,ca=!1,da=null,ea="tinyselect",fa=ea+"-context",ga=fa+"-with-arrow",ha=fa+"-placeholder",ia=fa+"-result",ja=fa+"-arrow",ka=fa+"-readonly",la=ea+"-container",ma=ea+"-mask",na=ea+"-scroll-proxy",oa=ea+"-group-content",pa=la+"-empty",qa=ea+"-header",ra=ea+"-footer",sa=ra+"-left",ta=ra+"-right",ua=ea+"-count-total",va=ea+"-count-selected",wa=ea+"-box",xa=ea+"-group",ya=ea+"-item",za=ea+"-item-before",Aa=ea+"-item-text",Ba=ea+"-item-after",Ca=ya+"-selected",Da=ya+"-hover",Ea=ea+"-filter",Fa=ea+"-result-item",Ga=Fa+"-text",Ha=Fa+"-link",Ia="select",Ja="unselect",Ka=[Ia,Ja],La="data",Ma="display",Na="visible",Oa="data-tiny-index",Pa="data-tiny-group",Qa="%s",Ra=":"+Na,Sa="span",Ta='<input type="checkbox" style="vertical-align:-2px;" class="{0}-selectall" />'.fill(ea),Ua="dropdown",Va="list",Wa="popup",Xa=[Ua,Va,Wa],Ya="table",Za=["list","grid",Ya],$a={ready:da,readonly:ca,mode:Ua,keyboard:ba,tabindex:0,css:da,style:{lineHeight:"28px"},header:{render:ca,filter:{trigger:"enter",delay:618,placeholder:"输入后按回车过滤",matchCase:ca,css:da,style:{}},css:da,style:{}},box:{empty:"没有数据",layout:"list",css:da,style:{}},group:{valueField:ca,textField:ca,unknown:"未分组",render:ca,css:da,style:{}},item:{data:[],value:ca,valueField:"id",textField:"text",visible:5,render:ca,async:ba,css:da,style:{}},footer:{render:ca,totalTpl:"共{0}项".fill(Qa),selectedTpl:"选中{0}项/".fill(Qa),css:da,style:{}},result:{placeholder:"请选择",clear:ba,multi:ca,arrow:da,render:ca,sync:ba,type:0,css:da,style:{}}};c.prototype={constructor:c,css:function(a){return a&&this.selector.push("."+a),this},attr:function(a,b){return 1===arguments.length?this.selector.push("[{0}]".fill(a)):this.selector.push("[{0}={0}]".fill(a,b)),this},sub:function(a){return this.selector.push(" "),this.css(a)},visible:function(){return this.addon(Ra).done()},first:function(){return this.addon(":first").done()},last:function(){return this.addon(":last").done()},addon:function(a){return a&&this.selector.push(a),this},done:function(a){return this.css(a),this.selector.join("")}},c.build=function(a){return new c(a)};var _a=function(a,b){return!a||a.hasOwnProperty(b)},ab=function(a,b){_(function(){a.apply(da,b)},0)},bb=function(a,c){return b.extend(ba,b.isArray(a)?[]:{},a,c)},cb=function(a,c){return b('<{0} class="{0}">'.fill(c||"div",a))},db=function(a,b){Array.prototype.push.apply(a,b)};d.fn=d.prototype={constructor:d,init:function(a,c,d){var h=this;if(h.ready=ca,b.isArray(c))h.option=bb($a,{item:{data:c},result:{multi:d}});else{h.option=bb($a,c);var i=h.option.mode||Ua;if(-1===Xa.indexOf(i))throw new Error('Render mode "{0}" is not supported,\nhere is the valid modes: {0}'.fill(i,Xa.join()));var j=h.option.layout||"list";if(-1===Za.indexOf(j))throw new Error('Item layout "{0}" is not supported,\nhere is the valid modes: {0}'.fill(j,Za.join()))}return c=h.option,h.source=a=b(a),h.context=a.is("select")?e(h,a):a,f(h),h.events={},g(h),o(h),h.load(c.item.data,function(){h.ready=ba,c.ready&&c.ready.call(h)}),h},on:function(a,b){var c=this;if(-1===Ka.indexOf(a))return $.warn("{0}:{0}".fill("不支持此事件类型",a)),c;var d=c.events;return _a(d,a)?d[a].push(b):d[a]=[b],c},off:function(a,b){var c=this;if(-1===Ka.indexOf(a))return c;var d=c.events;if(!_a(d,a))return c;var e=d[a],f=e.indexOf(b);return-1!==f&&e.splice(f,1),c},show:function(a){var b=this,d=b.dom,e=b.option.mode;return e===Va?b:(e===Wa&&b.mask.show(),q(b.context,d,b.option),d.fadeIn("fast",function(){d.find(c.build(qa).sub(Ea).visible()).focus(),r(b),a&&a.call(b)}),b)},hide:function(a){var b=this,c=b.option.mode;return c===Va?b:((c===Ua?b.dom:b.mask).fadeOut("fast",function(){a&&a.call(b)}),b)},filter:function(a,d){function e(a){if(i){var c=b(a).attr(Pa),d=l[c];++d.handled<d.total||Q(k,j,c)}}var f=this,g=[],h=b.isFunction(a),i=f.option.group.valueField,j=K(f),k=f.dom.find(c.build(xa).done()),l={};return k.each(function(){var a=b(this).attr(Pa);l[a]={total:j.filter(c.build(ya).attr(Pa,a).done()).length,handled:0}}),j.each(function(c,i){i=b(i);var j=O(i);(h?a.call(this,j):f.option.header.filter.matchCase?-1!==i.text().indexOf(a.toString()):-1!==i.text().toLowerCase().indexOf(a.toString().toLowerCase()))?(g.push({item:i,data:j}),d&&i.slideDown(50,function(){e(this)})):d&&i.slideUp(50,function(){e(this)})}),g},value:function(a,b){var c=this;return 0===arguments.length?C(c):(D(c,a,b),c)},clear:function(){return E(this),this},load:function(a,b){var c=this;return c.option.item.data=bb(a),m(c,function(){r(c),b&&b.call(c,c.option.item.data)}),c},readonly:function(a){var b=this;return 0===arguments.length?b.option.readonly:(a?(b.hide(),b.context.addClass(ka)):b.context.removeClass(ka),b.option.readonly=a,b)}},d.fn.init.prototype=d.fn,d.defaults=$a,a.tinyselect=d}(window,jQuery);
//# sourceMappingURL=tinyselect.min.js.map