/**
 * TinySelect 0.5.0 2018-05-22
 * @作者: hyjiacan
 * @源码: https://gitee.com/hyjiacan/TinySelect.git
 * @示例: http://hyjiacan.oschina.io/tinyselect
 * @许可协议: MIT
 * @依赖: jQuery 1.8.0及更高版本
 * @浏览器支持: 不支持IE8及更低版本
 * @QQ群: 187786345 (Javascript爱好者)
 */

!function(a,b){"use strict";function c(a){this.selector=[],this.css(a)}function d(a,c,e){var f=b(a).get(0);if(f){for(var g,h=0;h<Z.length;h++)if(g=Z[h],g.source.get(0)===f)return g;return g=new d.fn.init(f,c,e),Z.push(g),g}}function e(a,c){var d=b("<div>"),e=a.option,f=e.result,g=c.get(0);if(Object.defineProperty(a,"fromSelect",{writabke:da,configurable:da,value:ca}),!f||!f.style&&!f.css){var h=c.height();b.each(["padding","margin","box-sizing","color","background","background-color","font","border","lineHeight","top","right","bottom","left"],function(a,b){d.css(b,c.css(b))});var i=S(c,"position"),j=T(c);d.css({position:/^static$/.test(i)?"relative":i,width:c.width(),height:h,lineHeight:h-j.top-j.bottom+"px"})}f.multi=g.hasAttribute("multiple");var k=[],l=[],m=da;return c.find("option").each(function(){var a=b(this),c=a.parent(),d=a.val(),e={id:d,text:a.text()};c.is("optgroup")&&(m=ca,e.group=c.attr("label")),k.push(e),a.is(":selected")&&l.push(d)}),m&&(e.group.valueField="group"),e.item.data=k,l.length&&(e.item.value=l),(g.hasAttribute("readonly")||c.is(":disabled"))&&(e.readonly=ca),c.hide(),c.after(d),d}function f(a){var b=a.option,c=a.context,d=b.result,e=ba(b.tabindex);if(e=b.tabindex=isNaN(e)||e<0?da:e,e!==da&&c.attr("tabindex",e),c.addClass(ga),b.readonly&&c.addClass(la),d.css&&c.addClass(d.css),d.style&&c.css(d.style),b.mode!==Wa){c.append(a.placeholder=db(ia).html(b.result.placeholder)),c.append(db(ja));var f=d.arrow;f===da||f===ea&&d.multi||(c.addClass(ha).append(db(ka)),/static/i.test(S(c,"position"))&&c.css("position","relative"))}}function g(a){var c=a.option,d=a.context,e=a.dom=db(ma).addClass("{0}-mode-{0}".fill(fa,c.mode)),f=c.tabindex;switch(f!==da&&e.attr("tabindex",f),c.mode){case Wa:c.style.width=d.siblings(":visible").length?d.width():"auto",c.style.height=d.height()||"auto";var g=S(d,"position");c.style.position=/static/i.test(g)?"relative":g,d.append(e);break;case Va:b($.body).append(e);break;case Xa:b($.body).append((a.mask=db(na)).append(e))}e.addClass(c.css).css(c.style).append(h(a,c));var i=c.box,k=a.box=db(xa).addClass("{0}-layout-{0}".fill(xa,i.layout)).addClass(i.css).css(i.style);i.layout===Za&&k.append(db(oa)),e.append(k),e.append(j(a,c))}function h(a,b){var c=b.header,d=a.header=db(ra).addClass(c.css).css(c.style).append(i(a,b));return c.render&&c.render.call(d,b.item.data),d}function i(c,d){var e=d.header.filter,f=b('<input type="text"  placeholder="{0}" class="{0}" />'.fill(e.placeholder,Fa)).addClass(e.css).css(e.style);return f.keyup(function(d){var g=f.val();Y&&(a.clearTimeout(Y),Y=0),(/^change$/i.test(e.trigger)?""===b.trim(String.fromCharCode(d.keyCode||d.which))||f.data("last")!==g:13===d.keyCode)&&(f.data("last",g),Y=aa(function(){c.filter(g,ca)},e.delay))}),f}function j(a,b){var c=b.footer,d=a.footer=db(sa).addClass(c.css).css(c.style),e=db(ta),f=db(ua);return f.append(db(va,Ta).html(c.totalTpl.replace(Ra,0))),d.append(e).append(f),b.result.multi&&k(a,b,e,f),c.render&&c.render.call(d,b.data),d}function k(a,c,d,e){var f=b(Ua);d.append(b("<label>").append(f).append("全选")),f.change(function(){var c=f.is(":checked");K(a,Sa).each(function(d,e){if(e=b(e),c){if(e.hasClass(Da))return;return void G(a,e,ca)}e.hasClass(Da)&&H(a,e,ca)})});var g=db(wa,Ta);M(c,g),e.prepend(g)}function l(a,c){var d=c.valueField,e=c.textField||d,f=[{_group_item_:ca,text:c.unknown,id:0}],g={},h=0;b.each(a,function(){var a=this,b=ab(a,d),c=ab(a,e);if(!b)return a._group_id_=0,void f.push(a);var i=a[d],j=c?a[e]:"";ab(g,i)||(g[i]={id:++h,text:j,data:[]}),a._group_id_=h,g[i].data.push(a)});var i=[];return b.each(g,function(a,b){i.push({id:b.id,_group_item_:ca,key:a,text:b.text}),eb(i,b.data)}),f.length>1&&eb(i,f),i}function m(a,b){var d=a.box,e=a.option,f=e.item,g=f.data,h=e.group,i=ba(f.visible);(isNaN(i)||i<0)&&(i=0);var j=g?g.length:0;d.height("auto"),e.box.layout===Za?d.find(c.build(oa).first()).empty():d.empty(),a.fromSelect&&a.source.empty(),E(a),a.dom.removeClass(qa);var k=I(a);if(P(k,j),L(e,k),!j)return d.append(e.box.empty),a.dom.addClass(qa),void(b&&b.call(a,g));h.valueField&&(g=l(g,h),j=g.length);var m=n(a,d,f,g,b,0,i);if(isNaN(ba(a.dom.get(0).style.height))){if(0===i||i>=j)return;V(a);var o=R(m).height;W(a);var p=0;if(h.valueField){var q=d.find(c.build(ya));p=q.first().height()*q.length}d.height(i*o+p)}else{var r=a.dom.height();if(a.header.is(Sa)&&(r-=R(a.header).height),a.footer.is(Sa)&&(r-=R(a.footer).height),d.height(r),0===i||i>=j)return}f.async?bb(n,[a,d,f,g,b,i]):n(a,d,f,g,b,0)}function n(a,b,d,e,f,g,h){var i;a.option.box.layout===Za&&(b=b.find(c.build(oa).first()));var j=a.fromSelect,k=a.source,l=a.option.group,m=d.data;if(h=h||e.length-g,!(g>=e.length)){var n=g+h;n>e.length&&(n=e.length);for(var o,p=l.valueField,q=g;q<n;q++){var r=e[q];if(p&&r._group_item_){var s=db(ya).addClass(l.css).css(l.style).html(r.text).attr(Qa,r.id);l.render&&s.append(l.render.call(a,s,r)),b.append(s),o=ea,j&&k.append(db("","optgroup").text(r.text).attr("value",r.id))}else{o||(o=db(pa),b.append(o));var t=P(db(za),r),u=db(Aa),v=db(Ba),w=db(Ca);t.addClass(d.css).css(d.style).append(u).append(v).append(w),v.append(d.render?d.render.call(t,r,q,m):r[d.textField]),t.attr(Pa,q),p&&t.attr(Qa,r._group_id_),o.append(t),i||(i=t),j&&k.append(db("","option").text(r.text).attr("value",r.id))}}return n!==e.length?i:(d.value&&a.value(d.value,ca),f&&f.call(a,m),i)}}function o(c){c.option.mode!==Wa&&(p(c),s(c)),t(c),u(c),c.option.keyboard&&v(c),b(a).resize(function(){c.dom.is(Sa)&&(q(c.context,c.dom,c.option),r(c))})}function p(a){a.context.focus(function(){a.option.readonly||a.dom.is(Sa)||a.show()})}function q(c,d,e){var f=c.offset(),g=e.mode,h=d.height(),i=b(a).height(),j=R(c),k=j.height,l=j.width;g===Va?(i-f.top-k<h?f.top=f.top-h-2:f.top=f.top+k+2,d.css({left:f.left,top:f.top,width:e.style.width||l})):g===Xa&&d.parent().css({paddingTop:(i-h)/3,paddingLeft:(b(a).width()-d.width())/2})}function r(a){var b=a.dom;if("100%"!==b.get(0).style.height){var c=b.parent().height();if(c>0&&(a.option.mode===Wa||b.height()>=c)){var d=U(b);b.height(c-d.top-d.bottom)}}var e=b.get(0).style.height;e&&!/auto/i.test(e)&&a.box.height(b.height()-8-(a.header.is(Sa)?a.header.height():0)-(a.footer.is(Sa)?a.footer.height():0))}function s(c){var d=c.context,e=c.dom;b(a).click(function(a){var b=a.target;d.is(b)||e.is(b)||d.find(b).length||e.find(b).length||e.is(Sa)&&c.hide()})}function t(a){a.box.on("click",c.build(za).done(),function(){var c=b(this);F(a,c,ca,ca),a.fromSelect&&a.option.result.sync&&a.source.val(a.value()),a.option.result.multi||a.hide()})}function u(a){var b=a.context.find(c.build(ja).first()),d=J(a),e=a.option,f=e.result,g=f.multi,h=f.render;a.on(Ja,function(c){var f=c.data[e.item.textField];if(f=h?h.call(c.target,c.data):f,!g)return void b.html(f);if(e.mode!==Wa){var i=z(a,f,c.index);b.append(i),b.stop().animate({scrollTop:b[0].scrollHeight})}P(d,(O(d)||0)+1),M(e,d)}),g&&a.on(Ka,function(a){b.find(c.build(Ga).attr(Pa,a.index).first()).remove(),P(d,O(d)-1),M(e,d)})}function v(d){b(a).keydown(function(a){if(d.dom.is(Sa)){var b,e=d.box.find(c.build(Ea).first());switch(a.keyCode||a.which){case 40:b=x(d,e);break;case 38:b=w(d,e);break;case 32:case 13:return void e.click();case 27:return void d.hide();default:return}b.length||(b=e),d.header.find("."+Fa).blur(),b.focus(),e.removeClass(Ea),b.addClass(Ea),y(b)}}),d.dom.on("mouseover",c.build(za).done(),function(){d.box.find("."+Ea).removeClass(Ea),b(this).addClass(Ea)})}function w(a,b){if(0===b.length)return K(a).eq(0);var d=b.prev();return d.length||(d=b.parent().prevAll(c.build(pa).first()).find(c.build(za).last())),d}function x(a,b){if(0===b.length)return K(a).eq(0);var d=b.next();return d.length||(d=b.parent().nextAll(c.build(pa).first()).find(c.build(za).first())),d}function y(a){var b=a.parent().parent();/auto/i.test(S(b,"overflowY"))||(b=b.parent()),b.stop().animate({scrollTop:a.offset().top-b.offset().top+b.scrollTop()-R(a).height},100)}function z(a,b,d){if(a.option.mode!==Wa)return db(Ga).css(a.option.result.style).attr(Pa,d).append(db(Ha,Ta).html(b)).append(db(Ia,Ta).click(function(){if(!a.option.readonly)return H(a,K(a,c.build().attr(Pa,d).first()),ca),da}))}function A(a,b,c){return B(a,b,{target:c.get(0),data:O(c),index:c.attr(Pa)})}function B(a,b,c){if(ab(a.events,b)){c.type=b;for(var d=a.events[b],e=d.length-1;e>=0;e--)if(d[e].call(a,c)===da)return da}}function C(a){var d=a.option,e=d.item.valueField;if(!d.result.multi){var f=K(a,c.build(Da).first());return 0===f.length?void 0:O(f)[e]}return b.makeArray(K(a,c.build(Da).done()).map(function(a,c){return O(b(c))[e]}))}function D(a,c,d){for(var e,f=a.option,g=f.result.multi,h=b.makeArray(c),i=0,j=K(a);i<j.length;i++){e=b(j[i]);if(-1!==h.indexOf(O(e)[f.item.valueField])){if(F(a,e,da,d),!g)return}else g&&H(a,e,d)}}function E(a){var d=K(a);if(a.context.find(c.build(ja).first()).empty(),a.option.result.multi)return void d.filter(c.build(Da).done()).each(function(c,d){H(a,b(d),ca)});var e=d.filter(c.build(Da).first());e.length&&H(a,e,ca)}function F(a,b,d,e){var f=a.option.result.multi,g=b.hasClass(Da);if(!f){if(g)return;var h=a.box.find(c.build(Da).done()).not(b).first();return h.length&&H(a,h,e),void G(a,b,e)}if(!g)return void G(a,b,e);d&&H(a,b,e)}function G(a,b,c){c&&A(a,Ja,b)===da||(a.option.mode!==Wa&&a.placeholder.hide(),X(a),b.addClass(Da))}function H(a,b,c){c&&A(a,Ka,b)===da||(a.option.mode!==Wa&&a.placeholder.show(),X(a),b.removeClass(Da))}function I(a){return a.footer.find(c.build(ua).sub(va).done())}function J(a){return a.footer.find(c.build(ua).sub(wa).done())}function K(a,b){return a.box.find(c.build(za).addon(b).done())}function L(a,b){N(b,a.footer.totalTpl)}function M(a,b){N(b,a.footer.selectedTpl)}function N(a,b){a.html(b.replace(Ra,O(a)||0))}function O(a,b){return a.data(b||Ma)}function P(a,b,c){return a.data(c||Ma,b)}function Q(a,b,d){var e=a.filter(c.build().attr(Qa,d).done());0===b.filter(c.build().attr(Qa,d).visible()).length?e.hide():e.show()}function R(a){var b=a.width(),c=a.height(),d=T(a);return/^border-box$/i.test(S(a,"box-sizing"))&&(c+=d.top+d.bottom+ba(S(a,"border-top-width"))+ba(S(a,"border-bottom-width")),b+=d.left+d.right+ba(S(a,"border-left-width"))+ba(S(a,"border-right-width"))),{width:b,height:c}}function S(a,b){return a.css(b)}function T(a){return{top:ba(S(a,"padding-top"))||0,right:ba(S(a,"padding-right"))||0,bottom:ba(S(a,"padding-bottom"))||0,left:ba(S(a,"padding-left"))||0}}function U(a){return{top:ba(S(a,"border-top"))||0,right:ba(S(a,"border-right"))||0,bottom:ba(S(a,"border-bottom"))||0,left:ba(S(a,"border-left"))||0}}function V(a){P(a.dom,S(a.dom,Na),Na),a.dom.css({display:"block",visibility:"hidden"})}function W(a){a.dom.css({display:O(a.dom,Na)||"none",visibility:Oa})}function X(a){a.fromSelect&&a.source.val(a.value())}String.prototype.fill=function(){var a=[].slice.apply(arguments);return this.replace(/{([0-9]+)(\/.[lLrR]?)?}/g,function(b,c,d){var e=a.length?a.shift():"";if(e=null===e||void 0===e?"":String(e).toString(),0===c)return e;var f=c-e.length;if(f<=0)return e;for(var g=d[1],h=d[2]||"l",i="",j=0;j<f;j++)i+=g;return/r/i.test(h)?e+=i:e=i+e,e})};var Y,Z=[],$=a.document,_=a.console,aa=a.setTimeout,ba=a.parseInt,ca=!0,da=!1,ea=null,fa="tinyselect",ga=fa+"-context",ha=ga+"-with-arrow",ia=ga+"-placeholder",ja=ga+"-result",ka=ga+"-arrow",la=ga+"-readonly",ma=fa+"-container",na=fa+"-mask",oa=fa+"-scroll-proxy",pa=fa+"-group-content",qa=ma+"-empty",ra=fa+"-header",sa=fa+"-footer",ta=sa+"-left",ua=sa+"-right",va=fa+"-count-total",wa=fa+"-count-selected",xa=fa+"-box",ya=fa+"-group",za=fa+"-item",Aa=fa+"-item-before",Ba=fa+"-item-text",Ca=fa+"-item-after",Da=za+"-selected",Ea=za+"-hover",Fa=fa+"-filter",Ga=fa+"-result-item",Ha=Ga+"-text",Ia=Ga+"-link",Ja="select",Ka="unselect",La=[Ja,Ka],Ma="data",Na="display",Oa="visible",Pa="data-tiny-index",Qa="data-tiny-group",Ra="%s",Sa=":"+Oa,Ta="span",Ua='<input type="checkbox" style="vertical-align:-2px;" class="{0}-selectall" />'.fill(fa),Va="dropdown",Wa="list",Xa="popup",Ya=[Va,Wa,Xa],Za="table",$a=["list","grid",Za],_a={ready:ea,readonly:da,mode:Va,keyboard:ca,tabindex:0,css:ea,style:{lineHeight:"28px"},header:{render:da,filter:{trigger:"enter",delay:618,placeholder:"输入后按回车过滤",matchCase:da,css:ea,style:{}},css:ea,style:{}},box:{empty:"没有数据",layout:"list",css:ea,style:{}},group:{valueField:da,textField:da,unknown:"未分组",render:da,css:ea,style:{}},item:{data:[],value:da,valueField:"id",textField:"text",visible:5,render:da,async:ca,css:ea,style:{}},footer:{render:da,totalTpl:"共{0}项".fill(Ra),selectedTpl:"选中{0}项/".fill(Ra),css:ea,style:{}},result:{placeholder:"请选择",multi:da,arrow:ea,render:da,sync:ca,type:0,css:ea,style:{}}};c.prototype={constructor:c,css:function(a){return a&&this.selector.push("."+a),this},attr:function(a,b){return 1===arguments.length?this.selector.push("[{0}]".fill(a)):this.selector.push("[{0}={0}]".fill(a,b)),this},sub:function(a){return this.selector.push(" "),this.css(a)},visible:function(){return this.addon(Sa).done()},first:function(){return this.addon(":first").done()},last:function(){return this.addon(":last").done()},addon:function(a){return a&&this.selector.push(a),this},done:function(a){return this.css(a),this.selector.join("")}},c.build=function(a){return new c(a)};var ab=function(a,b){return!a||a.hasOwnProperty(b)},bb=function(a,b){aa(function(){a.apply(ea,b)},0)},cb=function(a,c){return b.extend(ca,b.isArray(a)?[]:{},a,c)},db=function(a,c){return b('<{0} class="{0}">'.fill(c||"div",a))},eb=function(a,b){Array.prototype.push.apply(a,b)};d.fn=d.prototype={constructor:d,init:function(a,c,d){var h=this;if(h.ready=da,b.isArray(c))h.option=cb(_a,{item:{data:c},result:{multi:d}});else{h.option=cb(_a,c);var i=h.option.mode||Va;if(-1===Ya.indexOf(i))throw new Error('Render mode "{0}" is not supported,\nhere is the valid modes: {0}'.fill(i,Ya.join()));var j=h.option.layout||"list";if(-1===$a.indexOf(j))throw new Error('Item layout "{0}" is not supported,\nhere is the valid modes: {0}'.fill(j,$a.join()))}return c=h.option,h.source=a=b(a),h.context=a.is("select")?e(h,a):a,f(h),h.events={},g(h),o(h),h.load(c.item.data,function(){h.ready=ca,c.ready&&c.ready.call(h)}),h},on:function(a,b){var c=this;if(-1===La.indexOf(a))return _.warn("{0}:{0}".fill("不支持此事件类型",a)),c;var d=c.events;return ab(d,a)?d[a].push(b):d[a]=[b],c},off:function(a,b){var c=this;if(-1===La.indexOf(a))return c;var d=c.events;if(!ab(d,a))return c;var e=d[a],f=e.indexOf(b);return-1!==f&&e.splice(f,1),c},show:function(a){var b=this,d=b.dom,e=b.option.mode;return e===Wa?b:(e===Xa&&b.mask.show(),q(b.context,d,b.option),d.fadeIn("fast",function(){d.find(c.build(ra).sub(Fa).visible()).focus(),r(b),a&&a.call(b)}),b)},hide:function(a){var b=this,c=b.option.mode;return c===Wa?b:((c===Va?b.dom:b.mask).fadeOut("fast",function(){a&&a.call(b)}),b)},filter:function(a,d){function e(a){if(i){var c=b(a).attr(Qa),d=l[c];++d.handled<d.total||Q(k,j,c)}}var f=this,g=[],h=b.isFunction(a),i=f.option.group.valueField,j=K(f),k=f.dom.find(c.build(ya).done()),l={};return k.each(function(){var a=b(this).attr(Qa);l[a]={total:j.filter(c.build(za).attr(Qa,a).done()).length,handled:0}}),j.each(function(c,i){i=b(i);var j=O(i);(h?a.call(this,j):f.option.header.filter.matchCase?-1!==i.text().indexOf(a.toString()):-1!==i.text().toLowerCase().indexOf(a.toString().toLowerCase()))?(g.push({item:i,data:j}),d&&i.slideDown(50,function(){e(this)})):d&&i.slideUp(50,function(){e(this)})}),g},value:function(a,b){var c=this;return 0===arguments.length?C(c):(D(c,a,b),c)},clear:function(){return E(this),this},load:function(a,b){var c=this;return c.option.item.data=cb(a),m(c,function(){r(c),b&&b.call(c,c.option.item.data)}),c},readonly:function(a){var b=this;return 0===arguments.length?b.option.readonly:(a?(b.hide(),b.context.addClass(la)):b.context.removeClass(la),b.option.readonly=a,b)}},d.fn.init.prototype=d.fn,d.defaults=_a,a.tinyselect=d}(window,jQuery);
//# sourceMappingURL=tinyselect.min.js.map