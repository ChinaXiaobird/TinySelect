/**
 * TinySelect 0.1.0 2017-02-10
 * @作者: hyjiacan
 * @源码: https://git.oschina.net/hyjiacan/TinySelect.git
 * @示例: http://hyjiacan.oschina.io/tinyselect
 * @许可协议: MIT
 * @依赖: jQuery 1.8.0及更高版本
 * @浏览器支持: 不支持IE8及更低版本
 * @QQ群: 187786345 (Javascript爱好者)
 */

!function(a,b){"use strict";function c(a,d){var e=b(a).get(0);if(e){for(var f,g=0;g<J.length;g++)if(f=J[g],f.context===e)return f;return f=new c.fn.init(e,d),J.push(f),f}}function d(a){var c=b(a.context);c.addClass(P).append(Da(R)),a.option.readonly&&c.addClass(T),a.option.result.multi||(c.addClass(Q).append(Da(S)),/static/i.test(c.css("position"))&&c.css("position","relative"))}function e(a){var c=a.option,d=b(a.context),e=Da(U).addClass(c.css);if(c.aslist){e.addClass(V),c.style.width=d.siblings().length?d.width():"auto",c.style.height=d.height()||"auto",c.style.display="block";var g=d.css("position");c.style.position=/static/i.test(g)?"relative":g,d.hide().after(e)}else b(K.body).append(e);a.dom=e.css(c.style),e.append(f(a,c)),e.append(Da(ba).css(c.box.style)),e.append(h(a,c))}function f(a,b){var c=Da(X);return c.css(a.option.header.style),c.append(g(a,b)),b.header.render&&b.header.render.call(c,b.data),c}function g(a,c){var d=c.header.filter,e=b('<input type="text"  placeholder="'+d.placeholder+'" class="'+ha+'" />').css(d.style);return e.on("keyup",function(b){var c=e.val();(/^change$/i.test(d.trigger)?e.data("last")!==c:13===b.keyCode)&&(e.data("last",c),a.filter(c,M))}),e}function h(a,b){var c=Da(Y);c.css(a.option.footer.style);var d=Da(Z),e=Da($);return e.append(Da(_,ua).html(b.footer.totalTpl.replace(ya,0))),c.append(d).append(e),b.result.multi&&i(a,b,d,e),b.footer.render&&b.footer.render.call(c,b.data),c}function i(a,c,d,e){var f=b(va);d.append(b("<label>").append(f).append("全选")),f.change(function(){var c=f.is(":checked");C(a,ta).each(function(d,e){if(e=b(e),c){if(e.hasClass(ga))return;return void y(a,e,M)}e.hasClass(ga)&&z(a,e,M)})});var g=Da(aa,ua);F(c,g),e.prepend(g)}function j(a,b){var c=a.dom.find(qa+ba),d=a.option.item,e=parseInt(d.visible);(isNaN(e)||e<0)&&(e=0);var f=d.data?d.data.length:0;c.empty().height("auto"),w(a),a.dom.removeClass(W);var g=A(a);if(I(g,f),E(a.option,g),!f)return c.append(a.option.box.empty),a.dom.addClass(W),void(b&&b.call(a,d.data));var h=k(a,c,d,b,0,e);if(!(0===e||e>=f)){var i=parseInt(h.css("lineHeight"))+parseInt(h.css("paddingTop"))+parseInt(h.css("paddingBottom"));c.height(e*i),d.async?Ba(function(){k(a,c,d,b,e)}):k(a,c,d,b,0)}}function k(a,b,c,d,e,f){var g,h=c.data;if(f=f||h.length-e,!(e>=h.length)){var i=e+f;i>h.length&&(i=h.length);for(var j=e;j<i;j++){var k=h[j],l=I(Da(ca),k),m=Da(da),n=Da(ea),o=Da(fa);l.css(a.option.item.style).append(m).append(n).append(o),n.append(c.render?c.render.call(l,k,j,h):k[c.textField]),l.attr(xa,j),b.append(l),g||(g=l)}return i!==h.length?g:(c.value&&a.value(c.value,!0),d&&d.call(a,h),g)}}function l(a){a.option.aslist||(m(a),o(a)),p(a),q(a)}function m(c){var d=b(c.context),e=c.dom;d.click(function(a){c.option.readonly||(d.is(a.target)||0!==d.find(a.target).length)&&(e.is(ta)||c.show())}),b(a).resize(function(){e.is(ta)&&n(d,e,c.option)})}function n(c,d,e){var f=c.offset();b(a).height()-f.top-c.height()<d.height()?f.top=f.top-d.height()-2:f.top=f.top+c.height()+2,d.css({left:f.left,top:f.top,width:e.style.width||c.width()})}function o(c){var d=b(c.context),e=c.dom;b(a).click(function(a){var b=a.target;d.is(b)||e.is(b)||d.find(b).length||e.find(b).length||e.is(ta)&&c.hide()})}function p(a){a.dom.find(qa+ba).delegate(qa+ca,"click",function(){var c=b(this);x(a,c,M,M),a.option.result.multi||a.hide()})}function q(a){var c=b(a.context).find(qa+R+sa),d=B(a),e=a.option,f=e.result,g=f.multi,h=f.render;a.on(la,function(b){var f=b.data[e.item.textField];return f=h?h.call(b.target,b.data):f,g?(c.append(r(a,f,b.index)),I(d,(H(d)||0)+1),void F(e,d)):void c.html(f)}),g&&a.on(ma,function(a){c.find(qa+ia+D(xa,a.index)+sa).fadeOut(function(){b(this).remove()}),I(d,H(d)-1),F(e,d)})}function r(a,c,d){return Da(ia).css(a.option.result.style).attr(xa,d).append(Da(ja,ua).html(c)).append(Da(ka,ua).click(function(){if(!a.option.readonly)return z(a,C(a,D(xa,d)+sa),M),N})).fadeIn(function(){var a=b(this).parent();a.stop().animate({scrollTop:a[0].scrollHeight})})}function s(a,b,c){var d=c.get(0);t(a,b,{target:d,data:H(c),index:c.attr(xa)})}function t(a,b,c){Aa.call(a.events,b)&&(c.type=b,a.events[b].forEach(function(b){b.call(a,c)}))}function u(a){var c=a.option.item.valueField;if(!a.option.result.multi){var d=C(a,qa+ga+sa);return 0===d.length?void 0:H(d)[c]}return C(a,qa+ga).map(function(a,d){return H(b(d))[c]})}function v(a,c,d){for(var e,f=b.makeArray(c),g=0,h=C(a);g<h.length;g++){e=b(h[g]);var i=f.indexOf(H(e)[a.option.item.valueField])!==-1;if(i&&(x(a,e,N,d),!a.option.result.multi))return}}function w(a){var c=C(a);if(b(a.context).find(qa+R+sa).empty(),a.option.result.multi)return void c.filter(qa+ga).each(function(c,d){z(a,b(d),M)});var d=c.filter(qa+ga+sa);d.length&&z(a,d,M)}function x(a,b,c,d){var e=a.option.result.multi,f=b.hasClass(ga);if(!e){if(f)return;var g=b.siblings(qa+ga);return g.length&&z(a,g,d),void y(a,b,d)}return f?void(c&&z(a,b,d)):void y(a,b,d)}function y(a,b,c){b.addClass(ga),c&&s(a,la,b)}function z(a,b,c){b.removeClass(ga),c&&s(a,ma,b)}function A(a){return a.dom.find(qa+Y+ra+$+ra+_)}function B(a){return a.dom.find(qa+Y+ra+$+ra+aa)}function C(a,b){return a.dom.find(qa+ba+ra+ca+(b||""))}function D(a,b){return"["+a+"="+b+"]"}function E(a,b){G(b,a.footer.totalTpl)}function F(a,b){G(b,a.footer.selectedTpl)}function G(a,b){a.html(b.replace(ya,H(a)||0))}function H(a){return a.data(wa)}function I(a,b){return a.data(wa,b)}var J=[],K=a.document,L=a.console,M=!0,N=!1,O="tinyselect",P=O+"-context",Q=P+"-with-dropdown",R=P+"-result",S=P+"-dropdown",T=P+"-readonly",U=O+"-container",V=O+"-list-mode",W=U+"-empty",X=O+"-header",Y=O+"-footer",Z=Y+"-left",$=Y+"-right",_=O+"-count-total",aa=O+"-count-selected",ba=O+"-box",ca=O+"-item",da=O+"-item-before",ea=O+"-item-text",fa=O+"-item-after",ga=ca+"-selected",ha=O+"-filter",ia=O+"-result-item",ja=ia+"-text",ka=ia+"-link",la="select",ma="unselect",na="ready",oa=[la,ma,na],pa="不支持此事件类型",qa=".",ra=" .",sa=":first",ta=":visible",ua="span",va='<input type="checkbox" style="vertical-align:-2px;" class="'+O+'-selectall" />',wa="data",xa="data-tiny-index",ya="%s",za={css:null,readonly:N,aslist:N,style:{position:"absolute",lineHeight:"28px",display:"none",zIndex:99},header:{render:N,filter:{trigger:"enter",placeholder:"请输入关键字",style:{}},style:{}},box:{empty:"没有数据",style:{}},item:{data:[],value:N,valueField:"id",textField:"text",visible:5,render:N,async:M,style:{}},footer:{render:N,totalTpl:"共"+ya+"项",selectedTpl:"选中"+ya+"项/",style:{}},result:{multi:N,render:N,type:0,style:{}}},Aa=Object.prototype.hasOwnProperty,Ba=function(b){a.setTimeout(b,0)},Ca=function(a,c){return b.extend(M,b.isArray(a)?[]:{},a,c)},Da=function(a,c){return b("<"+(c||"div")+' class="'+a+'">')};c.fn=c.prototype={constructor:c,init:function(a,c){var f=this;return b.isArray(c)?f.option=Ca(za,{item:{data:c}}):f.option=Ca(za,c),f.context=a,f.option.aslist||d(f),f.events={},e(f),l(f),j(f,function(a){t(f,na,{data:a})}),f},on:function(a,b){if(oa.indexOf(a)===-1)return L.warn(pa+":"+a),this;var c=this.events;return Aa.call(c,a)?c[a].push(b):c[a]=[b],this},off:function(a,b){if(oa.indexOf(a)===-1)return this;var c=this.events;if(!Aa.call(c,a))return this;var d=c[a].indexOf(b);return d!==-1&&c[a].splice(d,1),this},show:function(a){var c=this.dom;return this.option.aslist?this:(n(b(this.context),c,this.option),c.fadeIn("fast",function(){c.find(qa+X+ra+ha+ta).focus(),a&&a.call(this)}),this)},hide:function(a){return this.option.aslist?this:(this.dom.fadeOut("fast",function(){a&&a.call(this)}),this)},filter:function(a,c){var d=[],e=b.isFunction(a);return C(this).each(function(f,g){g=b(g);var h=H(g);(e?a.call(this,h):g.text().indexOf(a.toString())!==-1)?(d.push({item:g,data:h}),c&&g.show()):c&&g.hide()}),d},value:function(a,b){return 0===arguments.length?u(this):(v(this,a,b),this)},clear:function(){return w(this),this},load:function(a,b){return this.option.item.data=Ca(a),j(this,b),this},readonly:function(a){return 0===arguments.length?this.option.readonly:(a?(this.hide(),b(this.context).addClass(T)):b(this.context).removeClass(T),this.option.readonly=a,this)}},c.fn.init.prototype=c.fn,c.defaultOption=za,a.TinySelect=c}(window,jQuery);
//# sourceMappingURL=tinyselect.min.js.map