/**
 * TinySelect 0.2.0 2017-03-30
 * @作者: hyjiacan
 * @源码: https://git.oschina.net/hyjiacan/TinySelect.git
 * @示例: http://hyjiacan.oschina.io/tinyselect
 * @许可协议: MIT
 * @依赖: jQuery 1.8.0及更高版本
 * @浏览器支持: 不支持IE8及更低版本
 * @QQ群: 187786345 (Javascript爱好者)
 */

!function(a,b){"use strict";function c(a){this.selector=[],this.css(a)}function d(a,c){var e=b(a).get(0);if(e){for(var f,g=0;g<N.length;g++)if(f=N[g],f.context.get(0)===e)return f;return f=new d.fn.init(e,c),N.push(f),f}}function e(a){if(a.option.mode!==Fa){var b=a.context;b.addClass(V).append(Qa(X)),a.option.readonly&&b.addClass(Z),a.option.result.multi||(b.addClass(W).append(Qa(Y)),/static/i.test(b.css("position"))&&b.css("position","relative"))}}function f(a){var c=a.option,d=a.context,e=Qa($).addClass(c.css).addClass(U+"-mode-"+c.mode);switch(c.mode){case Fa:e.addClass(aa),c.style.width=d.siblings().length?d.width():"auto",c.style.height=d.height()||"auto";var f=d.css("position");c.style.position=/static/i.test(f)?"relative":f,d.hide().after(e);break;case Ea:b(O.body).append(e);break;case Ga:var h=a.mask=Qa(_);b(O.body).append(h.append(e))}a.dom=e.css(c.style),e.append(g(a,c));var j=Qa(ia).css(c.box.style);a.box=j.addClass(ia+"-layout-"+c.box.layout),e.append(j),e.append(i(a,c))}function g(a,b){var c=Qa(ca);return a.header=c,c.css(a.option.header.style),c.append(h(a,b)),b.header.render&&b.header.render.call(c,b.item.data),c}function h(c,d){var e=d.header.filter,f=b('<input type="text"  placeholder="'+e.placeholder+'" class="'+pa+'" />').css(e.style);return f.keyup(function(b){var g=f.val();M&&(a.clearTimeout(M),M=0),(/^change$/i.test(e.trigger)?f.data("last")!==g:13===b.keyCode)&&(f.data("last",g),M=Q(function(){c.filter(g,R)},d.header.filter.delay))}),f}function i(a,b){var c=Qa(da);a.footer=c,c.css(a.option.footer.style);var d=Qa(ea),e=Qa(fa);return e.append(Qa(ga,za).html(b.footer.totalTpl.replace(Da,0))),c.append(d).append(e),b.result.multi&&j(a,b,d,e),b.footer.render&&b.footer.render.call(c,b.data),c}function j(a,c,d,e){var f=b(Aa);d.append(b("<label>").append(f).append("全选")),f.change(function(){var c=f.is(":checked");G(a,ya).each(function(d,e){if(e=b(e),c){if(e.hasClass(na))return;return void C(a,e,R)}e.hasClass(na)&&D(a,e,R)})});var g=Qa(ha,za);I(c,g),e.prepend(g)}function k(a,b){var c=a.box,d=a.option.item,e=parseInt(d.visible);(isNaN(e)||e<0)&&(e=0);var f=d.data?d.data.length:0;c.empty().height("auto"),A(a),a.dom.removeClass(ba);var g=E(a);if(L(g,f),H(a.option,g),!f)return c.append(a.option.box.empty),a.dom.addClass(ba),void(b&&b.call(a,d.data));var h=l(a,c,d,b,0,e);if(!(0===e||e>=f)){if(isNaN(parseInt(a.dom.get(0).style.height))){var i=parseInt(h.css("lineHeight"))+parseInt(h.css("paddingTop"))+parseInt(h.css("paddingBottom"));c.height(e*i)}else{var j=a.dom.height();a.header.is(ya)&&(j-=a.header.height()),a.footer.is(ya)&&(j-=a.footer.height()),c.height(j)}d.async?Oa(l,[a,c,d,b,e]):l(a,c,d,b,0)}}function l(a,b,c,d,e,f){var g,h=c.data;if(f=f||h.length-e,!(e>=h.length)){var i=e+f;i>h.length&&(i=h.length);for(var j=e;j<i;j++){var k=h[j],l=L(Qa(ja),k),m=Qa(ka),n=Qa(la),o=Qa(ma);l.css(a.option.item.style).append(m).append(n).append(o),n.append(c.render?c.render.call(l,k,j,h):k[c.textField]),l.attr(Ca,j),b.append(l),g||(g=l)}return i!==h.length?g:(c.value&&a.value(c.value,!0),d&&d.call(a,h),g)}}function m(a){a.option.mode!==Fa&&(n(a),q(a)),r(a),s(a),t(a)}function n(c){var d=c.context,e=c.dom;d.click(function(a){c.option.readonly||(d.is(a.target)||0!==d.find(a.target).length)&&(e.is(ya)||c.show())}),b(a).resize(function(){e.is(ya)&&c.option.mode!==Fa&&(o(d,e,c.option),p(c))})}function o(c,d,e){var f=c.offset(),g=e.mode,h=d.height(),i=b(a).height();g===Ea?(i-f.top-c.height()<h?f.top=f.top-h-2:f.top=f.top+c.height()+2,d.css({left:f.left,top:f.top,width:e.style.width||c.width()})):g===Ga&&d.parent().css({paddingTop:(i-h)/3,paddingLeft:(b(a).width()-d.width())/2})}function p(a){var b=a.dom,c=b.parent().height();b.height()>c&&(b.height(c),a.box.height(c-(a.header.is(ya)?a.header.height():0)-(a.footer.is(ya)?a.footer.height():0)))}function q(c){var d=c.context,e=c.dom;b(a).click(function(a){var b=a.target;d.is(b)||e.is(b)||d.find(b).length||e.find(b).length||e.is(ya)&&c.hide()})}function r(a){a.box.on("click",c.build(ja).done(),function(){var c=b(this);B(a,c,R,R),a.option.result.multi||a.hide()})}function s(a){var b=a.context.find(c.build(X).first()),d=F(a),e=a.option,f=e.result,g=f.multi,h=f.render;a.on(ta,function(c){var f=c.data[e.item.textField];if(f=h?h.call(c.target,c.data):f,!g)return void b.html(f);var i=v(a,f,c.index);b.append(i),b.stop().animate({scrollTop:b[0].scrollHeight}),L(d,(K(d)||0)+1),I(e,d)}),g&&a.on(ua,function(a){b.find(c.build(qa).attr(Ca,a.index).first()).remove(),L(d,K(d)-1),I(e,d)})}function t(d){b(a).keydown(function(a){if(d.dom.is(ya)){var b,e=d.dom.find(c.build(oa).first());if(40===a.keyCode)b=0===e.length?G(d).eq(0):e.next();else{if(38!==a.keyCode)return;b=0===e.length?G(d).eq(0):e.prev()}b.length||(b=e),e.removeClass(oa),b.addClass(oa),u(b)}}),d.dom.on("mouseover",c.build(ja).done(),function(){b(this).addClass(oa).siblings().removeClass(oa)})}function u(a){var b=a.parent();/auto/i.test(b.css("overflowY"))||(b=b.parent()),b.stop().animate({scrollTop:a.offset().top-b.offset().top+b.scrollTop()},100)}function v(a,b,d){if(a.option.mode!==Fa)return Qa(qa).css(a.option.result.style).attr(Ca,d).append(Qa(ra,za).html(b)).append(Qa(sa,za).click(function(){if(!a.option.readonly)return D(a,G(a,c.build().attr(Ca,d).first()),R),S}))}function w(a,b,c){var d=c.get(0);x(a,b,{target:d,data:K(c),index:c.attr(Ca)})}function x(a,b,c){Na.call(a.events,b)&&(c.type=b,a.events[b].forEach(function(b){b.call(a,c)}))}function y(a){var d=a.option.item.valueField;if(!a.option.result.multi){var e=G(a,c.build(na).first());return 0===e.length?void 0:K(e)[d]}return G(a,c.build(na).done()).map(function(a,c){return K(b(c))[d]})}function z(a,c,d){for(var e,f=b.makeArray(c),g=0,h=G(a);g<h.length;g++){e=b(h[g]);var i=f.indexOf(K(e)[a.option.item.valueField])!==-1;if(i&&(B(a,e,S,d),!a.option.result.multi))return}}function A(a){var d=G(a);if(a.context.find(c.build(X).first()).empty(),a.option.result.multi)return void d.filter(c.build(na).done()).each(function(c,d){D(a,b(d),R)});var e=d.filter(c.build(na).first());e.length&&D(a,e,R)}function B(a,b,d,e){var f=a.option.result.multi,g=b.hasClass(na);if(!f){if(g)return;var h=b.siblings(c.build(na).first());return h.length&&D(a,h,e),void C(a,b,e)}return g?void(d&&D(a,b,e)):void C(a,b,e)}function C(a,b,c){b.addClass(na),c&&w(a,ta,b)}function D(a,b,c){b.removeClass(na),c&&w(a,ua,b)}function E(a){return a.footer.find(c.build(fa).sub(ga).done())}function F(a){return a.footer.find(c.build(fa).sub(ha).done())}function G(a,b){return a.box.find(c.build(ja).addon(b).done())}function H(a,b){J(b,a.footer.totalTpl)}function I(a,b){J(b,a.footer.selectedTpl)}function J(a,b){a.html(b.replace(Da,K(a)||0))}function K(a){return a.data(Ba)}function L(a,b){return a.data(Ba,b)}var M,N=[],O=a.document,P=a.console,Q=a.setTimeout,R=!0,S=!1,T=null,U="tinyselect",V=U+"-context",W=V+"-with-arrow",X=V+"-result",Y=V+"-arrow",Z=V+"-readonly",$=U+"-container",_=U+"-mask",aa=U+"-list-mode",ba=$+"-empty",ca=U+"-header",da=U+"-footer",ea=da+"-left",fa=da+"-right",ga=U+"-count-total",ha=U+"-count-selected",ia=U+"-box",ja=U+"-item",ka=U+"-item-before",la=U+"-item-text",ma=U+"-item-after",na=ja+"-selected",oa=ja+"-hover",pa=U+"-filter",qa=U+"-result-item",ra=qa+"-text",sa=qa+"-link",ta="select",ua="unselect",va="ready",wa=[ta,ua,va],xa="不支持此事件类型",ya=":visible",za="span",Aa='<input type="checkbox" style="vertical-align:-2px;" class="'+U+'-selectall" />',Ba="data",Ca="data-tiny-index",Da="%s",Ea="dropdown",Fa="list",Ga="popup",Ha=[Ea,Fa,Ga],Ia="list",Ja="grid",Ka="table",La=[Ia,Ja,Ka],Ma={css:T,readonly:S,mode:Ea,style:{lineHeight:"28px"},header:{render:S,filter:{trigger:"enter",delay:618,placeholder:"输入后按回车过滤",style:{}},style:{}},box:{empty:"没有数据",layout:Ia,style:{}},item:{data:[],value:S,valueField:"id",textField:"text",visible:5,render:S,async:R,style:{}},footer:{render:S,totalTpl:"共"+Da+"项",selectedTpl:"选中"+Da+"项/",style:{}},result:{multi:S,render:S,type:0,style:{}}};c.prototype={constructor:c,css:function(a){return a&&this.selector.push("."+a),this},attr:function(a,b){return 1===arguments.length?this.selector.push("["+a+"]"):this.selector.push("["+a+"="+b+"]"),this},sub:function(a){return this.selector.push(" "),this.css(a)},visible:function(){return this.addon(ya).done()},first:function(){return this.addon(":first").done()},addon:function(a){return a&&this.selector.push(a),this},done:function(a){return this.css(a),this.selector.join("")}},c.build=function(a){return new c(a)};var Na=Object.prototype.hasOwnProperty,Oa=function(a,b){Q(function(){a.apply(T,b)},0)},Pa=function(a,c){return b.extend(R,b.isArray(a)?[]:{},a,c)},Qa=function(a,c){return b("<"+(c||"div")+' class="'+a+'">')};d.fn=d.prototype={constructor:d,init:function(a,c){var d=this;if(b.isArray(c))d.option=Pa(Ma,{item:{data:c}});else{d.option=Pa(Ma,c);var g=d.option.mode||Ea;if(Ha.indexOf(g)===-1)throw new Error('Render mode "'+g+'" is not supported,\nhere is the valid modes:'+Ha.join());var h=d.option.layout||Ia;if(La.indexOf(h)===-1)throw new Error('Item layout "'+h+'" is not supported,\nhere is the valid modes:'+La.join())}return d.context=b(a),e(d),d.events={},f(d),m(d),d.load(d.option.item.data,function(a){x(d,va,{data:a})}),d},on:function(a,b){var c=this;if(wa.indexOf(a)===-1)return P.warn(xa+":"+a),c;var d=c.events;return Na.call(d,a)?d[a].push(b):d[a]=[b],c},off:function(a,b){var c=this;if(wa.indexOf(a)===-1)return c;var d=c.events;if(!Na.call(d,a))return c;var e=d[a],f=e.indexOf(b);return f!==-1&&e.splice(f,1),c},show:function(a){var b=this,d=b.dom,e=b.option.mode;return e===Fa?b:(e===Ga&&b.mask.show(),o(b.context,d,b.option),d.fadeIn("fast",function(){d.find(c.build(ca).sub(pa).visible()).focus(),p(b),a&&a.call(b)}),b)},hide:function(a){var b=this,c=b.option.mode;if(c===Fa)return b;var d=c===Ea?b.dom:b.mask;return d.fadeOut("fast",function(){a&&a.call(b)}),b},filter:function(a,c){var d=[],e=b.isFunction(a);return G(this).each(function(f,g){g=b(g);var h=K(g);(e?a.call(this,h):g.text().indexOf(a.toString())!==-1)?(d.push({item:g,data:h}),c&&g.show()):c&&g.hide()}),d},value:function(a,b){var c=this;return 0===arguments.length?y(c):(z(c,a,b),c)},clear:function(){return A(this),this},load:function(a,b){var c=this;return c.option.item.data=Pa(a),k(c,b),c},readonly:function(a){var b=this;return 0===arguments.length?b.option.readonly:(a?(b.hide(),b.context.addClass(Z)):b.context.removeClass(Z),b.option.readonly=a,b)}},d.fn.init.prototype=d.fn,d.defaults=Ma,a.tinyselect=d}(window,jQuery);
//# sourceMappingURL=tinyselect.js.map