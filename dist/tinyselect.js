/**
 * TinySelect 0.4.1 2017-12-20
 * @作者: hyjiacan
 * @源码: https://gitee.com/hyjiacan/TinySelect.git
 * @示例: http://hyjiacan.oschina.io/tinyselect
 * @许可协议: MIT
 * @依赖: jQuery 1.8.0及更高版本
 * @浏览器支持: 不支持IE8及更低版本
 * @QQ群: 187786345 (Javascript爱好者)
 */

!function(a,b){"use strict";function c(a){this.selector=[],this.css(a)}function d(a,c,e){var f=b(a).get(0);if(f){for(var g,h=0;h<X.length;h++)if(g=X[h],g.source.get(0)===f)return g;return g=new d.fn.init(f,c,e),X.push(g),g}}function e(a,c){var d=b("<div>"),e=a.option,f=e.result,g=c.get(0);if(Object.defineProperty(a,"fromSelect",{writabke:ba,configurable:ba,value:aa}),!f||!f.style&&!f.css){var h=c.height();b.each(["padding","margin","box-sizing","color","background","background-color","font","border","lineHeight","top","right","bottom","left"],function(a,b){d.css(b,c.css(b))});var i=S(c,"position"),j=T(c);d.css({position:/^static$/.test(i)?"relative":i,width:c.width(),height:h,lineHeight:h-j.top-j.bottom+"px"})}f.multi=g.hasAttribute("multiple");var k=[],l=[],m=ba;return c.find("option").each(function(){var a=b(this),c=a.parent(),d=a.val(),e={id:d,text:a.text()};c.is("optgroup")&&(m=aa,e.group=c.attr("label")),k.push(e),a.is(":selected")&&l.push(d)}),m&&(e.group.valueField="group"),e.item.data=k,l.length&&(e.item.value=l),(g.hasAttribute("readonly")||c.is(":disabled"))&&(e.readonly=aa),c.hide(),c.after(d),d}function f(a){if(a.option.mode!==Ra){var b=a.context,c=a.option.result;b.addClass(ea).append($a(ga)),c.css&&b.addClass(c.css),c.style&&b.css(c.style),a.option.readonly&&b.addClass(ia);var d=c.arrow;d===ba||d===ca&&c.multi||(b.addClass(fa).append($a(ha)),/static/i.test(S(b,"position"))&&b.css("position","relative"))}}function g(a){var c=a.option,d=a.context,e=a.dom=$a(ja).addClass("{0}-mode-{0}".fill(da,c.mode));switch(c.mode){case Ra:c.style.width=d.siblings().length?d.width():"auto",c.style.height=d.height()||"auto";var f=S(d,"position");c.style.position=/static/i.test(f)?"relative":f,d.append(e);break;case Qa:b(Y.body).append(e);break;case Sa:var g=a.mask=$a(ka);b(Y.body).append(g.append(e))}e.addClass(c.css).css(c.style).append(h(a,c));var i=c.box,k=a.box=$a(ua).addClass("{0}-layout-{0}".fill(ua,i.layout)).addClass(i.css).css(i.style);i.layout===Ua&&k.append($a(la)),e.append(k),e.append(j(a,c))}function h(a,b){var c=b.header,d=a.header=$a(oa).addClass(c.css).css(c.style).append(i(a,b));return c.render&&c.render.call(d,b.item.data),d}function i(c,d){var e=d.header.filter,f=b('<input type="text"  placeholder="{0}" class="{0}" />'.fill(e.placeholder,Ca)).addClass(e.css).css(e.style);return f.keyup(function(d){var g=f.val();W&&(a.clearTimeout(W),W=0),(/^change$/i.test(e.trigger)?""===b.trim(String.fromCharCode(d.keyCode||d.which))||f.data("last")!==g:13===d.keyCode)&&(f.data("last",g),W=$(function(){c.filter(g,aa)},e.delay))}),f}function j(a,b){var c=b.footer,d=a.footer=$a(pa).addClass(c.css).css(c.style),e=$a(qa),f=$a(ra);return f.append($a(sa,Ka).html(c.totalTpl.replace(Pa,0))),d.append(e).append(f),b.result.multi&&k(a,b,e,f),c.render&&c.render.call(d,b.data),d}function k(a,c,d,e){var f=b(La);d.append(b("<label>").append(f).append("全选")),f.change(function(){var c=f.is(":checked");K(a,Ja).each(function(d,e){if(e=b(e),c){if(e.hasClass(Aa))return;return void G(a,e,aa)}e.hasClass(Aa)&&H(a,e,aa)})});var g=$a(ta,Ka);M(c,g),e.prepend(g)}function l(a,c){var d=c.valueField,e=c.textField||d,f=[{_group_item_:aa,text:c.unknown,id:0}],g={},h=0;b.each(a,function(){var a=this,b=Xa(a,d),c=Xa(a,e);if(!b)return a._group_id_=0,void f.push(a);var i=a[d],j=c?a[e]:"";Xa(g,i)||(g[i]={id:++h,text:j,data:[]}),a._group_id_=h,g[i].data.push(a)});var i=[];return b.each(g,function(a,b){i.push({id:b.id,_group_item_:aa,key:a,text:b.text}),_a(i,b.data)}),f.length>1&&_a(i,f),i}function m(a,b){var d=a.box,e=a.option,f=e.item,g=f.data,h=e.group,i=_(f.visible);(isNaN(i)||i<0)&&(i=0);var j=g?g.length:0;d.height("auto"),e.box.layout===Ua?d.find(c.build(la).first()).empty():d.empty(),E(a),a.dom.removeClass(na);var k=I(a);if(P(k,j),L(e,k),!j)return d.append(e.box.empty),a.dom.addClass(na),void(b&&b.call(a,g));h.valueField&&(g=l(g,h),j=g.length);var m=n(a,d,f,g,b,0,i);if(isNaN(_(a.dom.get(0).style.height))){if(0===i||i>=j)return;U(a);var o=R(m).height;V(a);var p=0;if(h.valueField){var q=d.find(c.build(va));p=q.first().height()*q.length}d.height(i*o+p)}else{var r=a.dom.height();if(a.header.is(Ja)&&(r-=R(a.header).height),a.footer.is(Ja)&&(r-=R(a.footer).height),d.height(r),0===i||i>=j)return}f.async?Ya(n,[a,d,f,g,b,i]):n(a,d,f,g,b,0)}function n(a,b,d,e,f,g,h){var i;a.option.box.layout===Ua&&(b=b.find(c.build(la).first()));var j=a.option.group,k=d.data;if(h=h||e.length-g,!(g>=e.length)){var l=g+h;l>e.length&&(l=e.length);for(var m,n=j.valueField,o=g;o<l;o++){var p=e[o];if(n&&p._group_item_){var q=$a(va).addClass(j.css).css(j.style).html(p.text).attr(Oa,p.id);j.render&&q.append(j.render.call(a,q,p)),b.append(q),m=ca}else{m||(m=$a(ma),b.append(m));var r=P($a(wa),p),s=$a(xa),t=$a(ya),u=$a(za);r.addClass(d.css).css(d.style).append(s).append(t).append(u),t.append(d.render?d.render.call(r,p,o,k):p[d.textField]),r.attr(Na,o),n&&r.attr(Oa,p._group_id_),m.append(r),i||(i=r)}}return l!==e.length?i:(d.value&&a.value(d.value,aa),f&&f.call(a,k),i)}}function o(c){c.option.mode!==Ra&&(p(c),s(c)),t(c),u(c),c.option.keyboard&&v(c),b(a).resize(function(){c.dom.is(Ja)&&(q(c.context,c.dom,c.option),r(c))})}function p(a){var b=a.context,c=a.dom;b.click(function(d){a.option.readonly||(b.is(d.target)||0!==b.find(d.target).length)&&(c.is(Ja)||a.show())})}function q(c,d,e){var f=c.offset(),g=e.mode,h=d.height(),i=b(a).height(),j=R(c),k=j.height,l=j.width;g===Qa?(i-f.top-k<h?f.top=f.top-h-2:f.top=f.top+k+2,d.css({left:f.left,top:f.top,width:e.style.width||l})):g===Sa&&d.parent().css({paddingTop:(i-h)/3,paddingLeft:(b(a).width()-d.width())/2})}function r(a){var b=a.dom,c=b.parent().height();(a.option.mode===Ra||b.height()>=c)&&b.height(c);var d=b.get(0).style.height;d&&!/auto/i.test(d)&&a.box.height(b.height()-8-(a.header.is(Ja)?a.header.height():0)-(a.footer.is(Ja)?a.footer.height():0))}function s(c){var d=c.context,e=c.dom;b(a).click(function(a){var b=a.target;d.is(b)||e.is(b)||d.find(b).length||e.find(b).length||e.is(Ja)&&c.hide()})}function t(a){a.box.on("click",c.build(wa).done(),function(){var c=b(this);F(a,c,aa,aa),a.fromSelect&&a.option.result.sync&&a.source.val(a.value()),a.option.result.multi||a.hide()})}function u(a){var b=a.context.find(c.build(ga).first()),d=J(a),e=a.option,f=e.result,g=f.multi,h=f.render;a.on(Ga,function(c){var f=c.data[e.item.textField];if(f=h?h.call(c.target,c.data):f,!g)return void b.html(f);if(e.mode!==Ra){var i=z(a,f,c.index);b.append(i),b.stop().animate({scrollTop:b[0].scrollHeight})}P(d,(O(d)||0)+1),M(e,d)}),g&&a.on(Ha,function(a){b.find(c.build(Da).attr(Na,a.index).first()).remove(),P(d,O(d)-1),M(e,d)})}function v(d){b(a).keydown(function(a){if(d.dom.is(Ja)){var b,e=d.box.find(c.build(Ba).first());switch(a.keyCode||a.which){case 40:b=x(d,e);break;case 38:b=w(d,e);break;case 32:return void e.click();case 27:return void d.hide();default:return}b.length||(b=e),d.header.find("."+Ca).blur(),b.focus(),e.removeClass(Ba),b.addClass(Ba),y(b)}}),d.dom.on("mouseover",c.build(wa).done(),function(){d.box.find("."+Ba).removeClass(Ba),b(this).addClass(Ba)})}function w(a,b){if(0===b.length)return K(a).eq(0);var d=b.prev();return d.length||(d=b.parent().prevAll(c.build(ma).first()).find(c.build(wa).last())),d}function x(a,b){if(0===b.length)return K(a).eq(0);var d=b.next();return d.length||(d=b.parent().nextAll(c.build(ma).first()).find(c.build(wa).first())),d}function y(a){var b=a.parent().parent();/auto/i.test(S(b,"overflowY"))||(b=b.parent()),b.stop().animate({scrollTop:a.offset().top-b.offset().top+b.scrollTop()-R(a).height},100)}function z(a,b,d){if(a.option.mode!==Ra)return $a(Da).css(a.option.result.style).attr(Na,d).append($a(Ea,Ka).html(b)).append($a(Fa,Ka).click(function(){if(!a.option.readonly)return H(a,K(a,c.build().attr(Na,d).first()),aa),ba}))}function A(a,b,c){B(a,b,{target:c.get(0),data:O(c),index:c.attr(Na)})}function B(a,b,c){Xa(a.events,b)&&(c.type=b,a.events[b].forEach(function(b){b.call(a,c)}))}function C(a){var d=a.option.item.valueField;if(!a.option.result.multi){var e=K(a,c.build(Aa).first());return 0===e.length?void 0:O(e)[d]}return b.makeArray(K(a,c.build(Aa).done()).map(function(a,c){return O(b(c))[d]}))}function D(a,c,d){for(var e,f=b.makeArray(c),g=0,h=K(a);g<h.length;g++){e=b(h[g]);if(-1!==f.indexOf(O(e)[a.option.item.valueField])&&(F(a,e,ba,d),!a.option.result.multi))return}}function E(a){var d=K(a);if(a.context.find(c.build(ga).first()).empty(),a.option.result.multi)return void d.filter(c.build(Aa).done()).each(function(c,d){H(a,b(d),aa)});var e=d.filter(c.build(Aa).first());e.length&&H(a,e,aa)}function F(a,b,d,e){var f=a.option.result.multi,g=b.hasClass(Aa);if(!f){if(g)return;var h=a.box.find(c.build(Aa).done()).not(b).first();return h.length&&H(a,h,e),void G(a,b,e)}if(!g)return void G(a,b,e);d&&H(a,b,e)}function G(a,b,c){b.addClass(Aa),c&&A(a,Ga,b)}function H(a,b,c){b.removeClass(Aa),c&&A(a,Ha,b)}function I(a){return a.footer.find(c.build(ra).sub(sa).done())}function J(a){return a.footer.find(c.build(ra).sub(ta).done())}function K(a,b){return a.box.find(c.build(wa).addon(b).done())}function L(a,b){N(b,a.footer.totalTpl)}function M(a,b){N(b,a.footer.selectedTpl)}function N(a,b){a.html(b.replace(Pa,O(a)||0))}function O(a){return a.data(Ma)}function P(a,b){return a.data(Ma,b)}function Q(a,b,d){var e=a.filter(c.build().attr(Oa,d).done());0===b.filter(c.build().attr(Oa,d).visible()).length?e.hide():e.show()}function R(a){var b=a.width(),c=a.height(),d=T(a);return/^border-box$/i.test(S(a,"box-sizing"))&&(c+=d.top+d.bottom+_(S(a,"border-top-width"))+_(S(a,"border-bottom-width")),b+=d.left+d.right+_(S(a,"border-left-width"))+_(S(a,"border-right-width"))),{width:b,height:c}}function S(a,b){return a.css(b)}function T(a){return{top:_(S(a,"padding-top"))||0,right:_(S(a,"padding-right"))||0,bottom:_(S(a,"padding-bottom"))||0,left:_(S(a,"padding-left"))||0}}function U(a){a.dom.css({display:"block",visibility:"hidden"})}function V(a){a.dom.css({display:"none",visibility:"visible"})}String.prototype.fill=function(){var a=[].slice.apply(arguments);return this.replace(/{([0-9]+)(\/.[lLrR]?)?}/g,function(b,c,d){var e=a.length?a.shift():"";if(e=null===e||void 0===e?"":String(e).toString(),0===c)return e;var f=c-e.length;if(f<=0)return e;for(var g=d[1],h=d[2]||"l",i="",j=0;j<f;j++)i+=g;return/r/i.test(h)?e+=i:e=i+e,e})};var W,X=[],Y=a.document,Z=a.console,$=a.setTimeout,_=a.parseInt,aa=!0,ba=!1,ca=null,da="tinyselect",ea=da+"-context",fa=ea+"-with-arrow",ga=ea+"-result",ha=ea+"-arrow",ia=ea+"-readonly",ja=da+"-container",ka=da+"-mask",la=da+"-scroll-proxy",ma=da+"-group-content",na=ja+"-empty",oa=da+"-header",pa=da+"-footer",qa=pa+"-left",ra=pa+"-right",sa=da+"-count-total",ta=da+"-count-selected",ua=da+"-box",va=da+"-group",wa=da+"-item",xa=da+"-item-before",ya=da+"-item-text",za=da+"-item-after",Aa=wa+"-selected",Ba=wa+"-hover",Ca=da+"-filter",Da=da+"-result-item",Ea=Da+"-text",Fa=Da+"-link",Ga="select",Ha="unselect",Ia=[Ga,Ha,"ready"],Ja=":visible",Ka="span",La='<input type="checkbox" style="vertical-align:-2px;" class="'+da+'-selectall" />',Ma="data",Na="data-tiny-index",Oa="data-tiny-group",Pa="%s",Qa="dropdown",Ra="list",Sa="popup",Ta=[Qa,Ra,Sa],Ua="table",Va=["list","grid",Ua],Wa={readonly:ba,mode:Qa,keyboard:aa,css:ca,style:{lineHeight:"28px"},header:{render:ba,filter:{trigger:"enter",delay:618,placeholder:"输入后按回车过滤",matchCase:ba,css:ca,style:{}},css:ca,style:{}},box:{empty:"没有数据",layout:"list",css:ca,style:{}},group:{valueField:ba,textField:ba,unknown:"未分组",render:ba,css:ca,style:{}},item:{data:[],value:ba,valueField:"id",textField:"text",visible:5,render:ba,async:aa,css:ca,style:{}},footer:{render:ba,totalTpl:"共{0}项".fill(Pa),selectedTpl:"选中{0}项/".fill(Pa),css:ca,style:{}},result:{multi:ba,arrow:ca,render:ba,sync:aa,type:0,css:ca,style:{}}};c.prototype={constructor:c,css:function(a){return a&&this.selector.push("."+a),this},attr:function(a,b){return 1===arguments.length?this.selector.push("[{0}]".fill(a)):this.selector.push("[{0}={0}]".fill(a,b)),this},sub:function(a){return this.selector.push(" "),this.css(a)},visible:function(){return this.addon(Ja).done()},first:function(){return this.addon(":first").done()},last:function(){return this.addon(":last").done()},addon:function(a){return a&&this.selector.push(a),this},done:function(a){return this.css(a),this.selector.join("")}},c.build=function(a){return new c(a)};var Xa=function(a,b){return!a||a.hasOwnProperty(b)},Ya=function(a,b){$(function(){a.apply(ca,b)},0)},Za=function(a,c){return b.extend(aa,b.isArray(a)?[]:{},a,c)},$a=function(a,c){return b('<{0} class="{0}">'.fill(c||"div",a))},_a=function(a,b){Array.prototype.push.apply(a,b)};d.fn=d.prototype={constructor:d,init:function(a,c,d){var h=this;if(b.isArray(c))h.option=Za(Wa,{item:{data:c},result:{multi:d}});else{h.option=Za(Wa,c);var i=h.option.mode||Qa;if(-1===Ta.indexOf(i))throw new Error('Render mode "{0}" is not supported,\nhere is the valid modes: {0}'.fill(i,Ta.join()));var j=h.option.layout||"list";if(-1===Va.indexOf(j))throw new Error('Item layout "{0}" is not supported,\nhere is the valid modes: {0}'.fill(j,Va.join()))}return h.source=a=b(a),h.context=a.is("select")?e(h,a):a,f(h),h.events={},g(h),o(h),h.load(h.option.item.data,function(a){B(h,"ready",{data:a})}),h},on:function(a,b){var c=this;if(-1===Ia.indexOf(a))return Z.warn("{0}:{0}".fill("不支持此事件类型",a)),c;var d=c.events;return Xa(d,a)?d[a].push(b):d[a]=[b],c},off:function(a,b){var c=this;if(-1===Ia.indexOf(a))return c;var d=c.events;if(!Xa(d,a))return c;var e=d[a],f=e.indexOf(b);return-1!==f&&e.splice(f,1),c},show:function(a){var b=this,d=b.dom,e=b.option.mode;return e===Ra?b:(e===Sa&&b.mask.show(),q(b.context,d,b.option),d.fadeIn("fast",function(){d.find(c.build(oa).sub(Ca).visible()).focus(),r(b),a&&a.call(b)}),b)},hide:function(a){var b=this,c=b.option.mode;return c===Ra?b:((c===Qa?b.dom:b.mask).fadeOut("fast",function(){a&&a.call(b)}),b)},filter:function(a,d){function e(a){if(i){var c=b(a).attr(Oa),d=l[c];++d.handled<d.total||Q(k,j,c)}}var f=this,g=[],h=b.isFunction(a),i=!!f.option.group.valueField,j=K(f),k=f.dom.find(c.build(va).done()),l={};return k.each(function(){var a=b(this).attr(Oa);l[a]={total:j.filter(c.build(wa).attr(Oa,a).done()).length,handled:0}}),j.each(function(c,i){i=b(i);var j=O(i);(h?a.call(this,j):f.option.header.filter.matchCase?-1!==i.text().indexOf(a.toString()):-1!==i.text().toLowerCase().indexOf(a.toString().toLowerCase()))?(g.push({item:i,data:j}),d&&i.slideDown(50,function(){e(this)})):d&&i.slideUp(50,function(){e(this)})}),g},value:function(a,b){var c=this;return 0===arguments.length?C(c):(D(c,a,b),c)},clear:function(){return E(this),this},load:function(a,b){var c=this;return c.option.item.data=Za(a),m(c,function(){r(c),b&&b.call(c,c.option.item.data)}),c},readonly:function(a){var b=this;return 0===arguments.length?b.option.readonly:(a?(b.hide(),b.context.addClass(ia)):b.context.removeClass(ia),b.option.readonly=a,b)}},d.fn.init.prototype=d.fn,d.defaults=Wa,a.tinyselect=d}(window,jQuery);
//# sourceMappingURL=tinyselect.js.map