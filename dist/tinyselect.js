/**
 * TinySelect 0.2.0 2017-03-30
 * @作者: hyjiacan
 * @源码: https://git.oschina.net/hyjiacan/TinySelect.git
 * @示例: http://hyjiacan.oschina.io/tinyselect
 * @许可协议: MIT
 * @依赖: jQuery 1.8.0及更高版本
 * @浏览器支持: 不支持IE8及更低版本
 * @QQ群: 187786345 (Javascript爱好者)
 */

!function(a,b){"use strict";function c(a){this.selector=[],this.css(a)}function d(a,c){var e=b(a).get(0);if(e){for(var f,g=0;g<L.length;g++)if(f=L[g],f.context===e)return f;return f=new d.fn.init(e,c),L.push(f),f}}function e(a){if(a.option.mode!==Ba){var c=b(a.context);c.addClass(R).append(Ia(T)),a.option.readonly&&c.addClass(V),a.option.result.multi||(c.addClass(S).append(Ia(U)),/static/i.test(c.css("position"))&&c.css("position","relative"))}}function f(a){var c=a.option,d=b(a.context),e=Ia(W).addClass(c.css).addClass(Q+"-mode-"+c.mode);switch(c.mode){case Ba:e.addClass(Y),c.style.width=d.siblings().length?d.width():"auto",c.style.height=d.height()||"auto";var f=d.css("position");c.style.position=/static/i.test(f)?"relative":f,d.hide().after(e);break;case Aa:b(M.body).append(e);break;case Ca:var h=a.mask=Ia(X);b(M.body).append(h.append(e))}a.dom=e.css(c.style),e.append(g(a,c));var j=Ia(ea).css(c.box.style);a.box=j,e.append(j),e.append(i(a,c))}function g(a,b){var c=Ia($);return a.header=c,c.css(a.option.header.style),c.append(h(a,b)),b.header.render&&b.header.render.call(c,b.item.data),c}function h(a,c){var d=c.header.filter,e=b('<input type="text"  placeholder="'+d.placeholder+'" class="'+la+'" />').css(d.style);return e.on("keyup",function(b){var c=e.val();(/^change$/i.test(d.trigger)?e.data("last")!==c:13===b.keyCode)&&(e.data("last",c),a.filter(c,O))}),e}function i(a,b){var c=Ia(_);a.footer=c,c.css(a.option.footer.style);var d=Ia(aa),e=Ia(ba);return e.append(Ia(ca,va).html(b.footer.totalTpl.replace(za,0))),c.append(d).append(e),b.result.multi&&j(a,b,d,e),b.footer.render&&b.footer.render.call(c,b.data),c}function j(a,c,d,e){var f=b(wa);d.append(b("<label>").append(f).append("全选")),f.change(function(){var c=f.is(":checked");F(a,ua).each(function(d,e){if(e=b(e),c){if(e.hasClass(ja))return;return void B(a,e,O)}e.hasClass(ja)&&C(a,e,O)})});var g=Ia(da,va);H(c,g),e.prepend(g)}function k(a,b){var c=a.box,d=a.option.item,e=parseInt(d.visible);(isNaN(e)||e<0)&&(e=0);var f=d.data?d.data.length:0;c.empty().height("auto"),z(a),a.dom.removeClass(Z);var g=D(a);if(K(g,f),G(a.option,g),!f)return c.append(a.option.box.empty),a.dom.addClass(Z),void(b&&b.call(a,d.data));var h=l(a,c,d,b,0,e);if(!(0===e||e>=f)){if(isNaN(parseInt(a.dom.get(0).style.height))){var i=parseInt(h.css("lineHeight"))+parseInt(h.css("paddingTop"))+parseInt(h.css("paddingBottom"));c.height(e*i)}else{var j=a.dom.height();a.header.is(ua)&&(j-=a.header.height()),a.footer.is(ua)&&(j-=a.footer.height()),c.height(j)}d.async?Ga(l,[a,c,d,b,e]):l(a,c,d,b,0)}}function l(a,b,c,d,e,f){var g,h=c.data;if(f=f||h.length-e,!(e>=h.length)){var i=e+f;i>h.length&&(i=h.length);for(var j=e;j<i;j++){var k=h[j],l=K(Ia(fa),k),m=Ia(ga),n=Ia(ha),o=Ia(ia);l.css(a.option.item.style).append(m).append(n).append(o),n.append(c.render?c.render.call(l,k,j,h):k[c.textField]),l.attr(ya,j),b.append(l),g||(g=l)}return i!==h.length?g:(c.value&&a.value(c.value,!0),d&&d.call(a,h),g)}}function m(a){a.option.aslist||(n(a),p(a)),q(a),r(a),s(a)}function n(c){var d=b(c.context),e=c.dom;d.click(function(a){c.option.readonly||(d.is(a.target)||0!==d.find(a.target).length)&&(e.is(ua)||c.show())}),b(a).resize(function(){e.is(ua)&&c.option.mode!==Ba&&o(d,e,c.option)})}function o(c,d,e){var f=c.offset(),g=e.mode,h=d.height(),i=b(a).height();g===Aa?(i-f.top-c.height()<h?f.top=f.top-h-2:f.top=f.top+c.height()+2,d.css({left:f.left,top:f.top,width:e.style.width||c.width()})):g===Ca&&d.parent().css({paddingTop:(i-h)/3,paddingLeft:(b(a).width()-d.width())/2})}function p(c){var d=b(c.context),e=c.dom;b(a).click(function(a){var b=a.target;d.is(b)||e.is(b)||d.find(b).length||e.find(b).length||e.is(ua)&&c.hide()})}function q(a){a.box.on("click",c.build(fa).done(),function(){var c=b(this);A(a,c,O,O),a.option.result.multi||a.hide()})}function r(a){var d=b(a.context).find(c.build(T).first()),e=E(a),f=a.option,g=f.result,h=g.multi,i=g.render;a.on(pa,function(b){var c=b.data[f.item.textField];if(c=i?i.call(b.target,b.data):c,!h)return void d.html(c);var g=u(a,c,b.index);d.append(g),d.stop().animate({scrollTop:d[0].scrollHeight}),K(e,(J(e)||0)+1),H(f,e)}),h&&a.on(qa,function(a){d.find(c.build(ma).attr(ya,a.index).first()).remove(),K(e,J(e)-1),H(f,e)})}function s(d){b(a).keydown(function(a){if(d.dom.is(ua)){var b,e=d.dom.find(c.build(ka).first());if(40===a.keyCode)b=0===e.length?F(d).eq(0):e.next();else{if(38!==a.keyCode)return;b=0===e.length?F(d).eq(0):e.prev()}b.length||(b=e),e.removeClass(ka),b.addClass(ka),t(b)}}),d.dom.on("mouseover",c.build(fa).done(),function(){b(this).addClass(ka).siblings().removeClass(ka)})}function t(a){var b=a.parent();/auto/i.test(b.css("overflowY"))||(b=b.parent()),b.stop().animate({scrollTop:a.offset().top-b.offset().top+b.scrollTop()},100)}function u(a,b,d){if(!a.option.aslist)return Ia(ma).css(a.option.result.style).attr(ya,d).append(Ia(na,va).html(b)).append(Ia(oa,va).click(function(){if(!a.option.readonly)return C(a,F(a,c.build().attr(ya,d).first()),O),P}))}function v(a,b,c){var d=c.get(0);w(a,b,{target:d,data:J(c),index:c.attr(ya)})}function w(a,b,c){Fa.call(a.events,b)&&(c.type=b,a.events[b].forEach(function(b){b.call(a,c)}))}function x(a){var d=a.option.item.valueField;if(!a.option.result.multi){var e=F(a,c.build(ja).first());return 0===e.length?void 0:J(e)[d]}return F(a,c.build(ja).done()).map(function(a,c){return J(b(c))[d]})}function y(a,c,d){for(var e,f=b.makeArray(c),g=0,h=F(a);g<h.length;g++){e=b(h[g]);var i=f.indexOf(J(e)[a.option.item.valueField])!==-1;if(i&&(A(a,e,P,d),!a.option.result.multi))return}}function z(a){var d=F(a);if(b(a.context).find(c.build(T).first()).empty(),a.option.result.multi)return void d.filter(c.build(ja).done()).each(function(c,d){C(a,b(d),O)});var e=d.filter(c.build(ja).first());e.length&&C(a,e,O)}function A(a,b,d,e){var f=a.option.result.multi,g=b.hasClass(ja);if(!f){if(g)return;var h=b.siblings(c.build(ja).first());return h.length&&C(a,h,e),void B(a,b,e)}return g?void(d&&C(a,b,e)):void B(a,b,e)}function B(a,b,c){b.addClass(ja),c&&v(a,pa,b)}function C(a,b,c){b.removeClass(ja),c&&v(a,qa,b)}function D(a){return a.footer.find(c.build(ba).sub(ca).done())}function E(a){return a.footer.find(c.build(ba).sub(da).done())}function F(a,b){return a.box.find(c.build(fa).addon(b).done())}function G(a,b){I(b,a.footer.totalTpl)}function H(a,b){I(b,a.footer.selectedTpl)}function I(a,b){a.html(b.replace(za,J(a)||0))}function J(a){return a.data(xa)}function K(a,b){return a.data(xa,b)}var L=[],M=a.document,N=a.console,O=!0,P=!1,Q="tinyselect",R=Q+"-context",S=R+"-with-arrow",T=R+"-result",U=R+"-arrow",V=R+"-readonly",W=Q+"-container",X=Q+"-mask",Y=Q+"-list-mode",Z=W+"-empty",$=Q+"-header",_=Q+"-footer",aa=_+"-left",ba=_+"-right",ca=Q+"-count-total",da=Q+"-count-selected",ea=Q+"-box",fa=Q+"-item",ga=Q+"-item-before",ha=Q+"-item-text",ia=Q+"-item-after",ja=fa+"-selected",ka=fa+"-hover",la=Q+"-filter",ma=Q+"-result-item",na=ma+"-text",oa=ma+"-link",pa="select",qa="unselect",ra="ready",sa=[pa,qa,ra],ta="不支持此事件类型",ua=":visible",va="span",wa='<input type="checkbox" style="vertical-align:-2px;" class="'+Q+'-selectall" />',xa="data",ya="data-tiny-index",za="%s",Aa="dropdown",Ba="list",Ca="popup",Da=[Aa,Ba,Ca],Ea={css:null,readonly:P,mode:Aa,style:{lineHeight:"28px"},header:{render:P,filter:{trigger:"enter",placeholder:"请输入关键字",style:{}},style:{}},box:{empty:"没有数据",style:{}},item:{data:[],value:P,valueField:"id",textField:"text",visible:5,render:P,async:O,style:{}},footer:{render:P,totalTpl:"共"+za+"项",selectedTpl:"选中"+za+"项/",style:{}},result:{multi:P,render:P,type:0,style:{}}};c.prototype={constructor:c,css:function(a){return a&&this.selector.push("."+a),this},attr:function(a,b){return 1===arguments.length?this.selector.push("["+a+"]"):this.selector.push("["+a+"="+b+"]"),this},sub:function(a){return this.selector.push(" "),this.css(a)},visible:function(a){return this.css(a),this.selector.push(ua),this.done()},first:function(a){return this.css(a),this.selector.push(":first"),this.done()},addon:function(a){return a&&this.selector.push(a),this},done:function(a){return this.css(a),this.selector.join("")}},c.build=function(a){return new c(a)};var Fa=Object.prototype.hasOwnProperty,Ga=function(b,c){a.setTimeout(function(){b.apply(null,c)},0)},Ha=function(a,c){return b.extend(O,b.isArray(a)?[]:{},a,c)},Ia=function(a,c){return b("<"+(c||"div")+' class="'+a+'">')};d.fn=d.prototype={constructor:d,init:function(a,c){var d=this;if(b.isArray(c))d.option=Ha(Ea,{item:{data:c}});else{d.option=Ha(Ea,c);var g=d.option.mode||Aa;if(Da.indexOf(g)===-1)throw new Error('Render mode "'+g+'" is not supported,\nhere is the valid modes:'+Da.join())}return d.context=a,e(d),d.events={},f(d),m(d),k(d,function(a){w(d,ra,{data:a})}),d},on:function(a,b){if(sa.indexOf(a)===-1)return N.warn(ta+":"+a),this;var c=this.events;return Fa.call(c,a)?c[a].push(b):c[a]=[b],this},off:function(a,b){if(sa.indexOf(a)===-1)return this;var c=this.events;if(!Fa.call(c,a))return this;var d=c[a].indexOf(b);return d!==-1&&c[a].splice(d,1),this},show:function(a){var d=this.dom,e=this.option.mode;return e===Ba?this:(e===Ca&&this.mask.show(),o(b(this.context),d,this.option),d.fadeIn("fast",function(){d.find(c.build($).sub(la).visible()).focus(),a&&a.call(this)}),this)},hide:function(a){if(this.option.mode===Ba)return this;var b=this.option.mode===Aa?this.dom:this.mask;return b.fadeOut("fast",function(){a&&a.call(this)}),this},filter:function(a,c){var d=[],e=b.isFunction(a);return F(this).each(function(f,g){g=b(g);var h=J(g);(e?a.call(this,h):g.text().indexOf(a.toString())!==-1)?(d.push({item:g,data:h}),c&&g.show()):c&&g.hide()}),d},value:function(a,b){var c=this;return 0===arguments.length?x(c):(y(c,a,b),c)},clear:function(){return z(this),this},load:function(a,b){var c=this,d=c.dom;c.option.item.data=Ha(a),k(c,b);var e=d.parent().height();return d.height()>e&&d.height(e),c},readonly:function(a){var c=this;return 0===arguments.length?c.option.readonly:(a?(c.hide(),b(c.context).addClass(V)):b(c.context).removeClass(V),c.option.readonly=a,c)}},d.fn.init.prototype=d.fn,d.defaultOption=Ea,a.tinyselect=d}(window,jQuery);
//# sourceMappingURL=tinyselect.js.map