/**
 * TinySelect 0.4.0 2017-12-19
 * @作者: hyjiacan
 * @源码: https://gitee.com/hyjiacan/TinySelect.git
 * @示例: http://hyjiacan.oschina.io/tinyselect
 * @许可协议: MIT
 * @依赖: jQuery 1.8.0及更高版本
 * @浏览器支持: 不支持IE8及更低版本
 * @QQ群: 187786345 (Javascript爱好者)
 */

!function(a,b){"use strict";function c(a){this.selector=[],this.css(a)}function d(a,c,e){var f=b(a).get(0);if(f){for(var g,h=0;h<V.length;h++)if(g=V[h],g.source.get(0)===f)return g;return g=new d.fn.init(f,c,e),V.push(g),g}}function e(a,c){var d=b("<div>"),e=a.option,f=e.result,g=c.get(0);if(Object.defineProperty(a,"fromSelect",{writabke:_,configurable:_,value:$}),!f||!f.style&&!f.css){var h=c.height();b.each(["padding","margin","box-sizing","color","background","background-color","font","border","lineHeight","top","right","bottom","left"],function(a,b){d.css(b,c.css(b))});var i=Q(c,"position"),j=R(c);d.css({position:/^static$/.test(i)?"relative":i,width:c.width(),height:h,lineHeight:h-j.top-j.bottom+"px"})}f.multi=g.hasAttribute("multiple");var k=[],l=[],m=_;return c.find("option").each(function(){var a=b(this),c=a.parent(),d=a.val(),e={id:d,text:a.text()};c.is("optgroup")&&(m=$,e.group=c.attr("label")),k.push(e),a.is(":selected")&&l.push(d)}),m&&(e.group.valueField="group"),e.item.data=k,l.length&&(e.item.value=l),(g.hasAttribute("readonly")||c.is(":disabled"))&&(e.readonly=$),c.hide(),c.after(d),d}function f(a){if(a.option.mode!==Pa){var b=a.context,c=a.option.result;b.addClass(ca).append(Ya(ea)),c.css&&b.addClass(c.css),c.style&&b.css(c.style),a.option.readonly&&b.addClass(ga);var d=c.arrow;d===_||d===aa&&c.multi||(b.addClass(da).append(Ya(fa)),/static/i.test(Q(b,"position"))&&b.css("position","relative"))}}function g(a){var c=a.option,d=a.context,e=a.dom=Ya(ha).addClass("{0}-mode-{0}".fill(ba,c.mode));switch(c.mode){case Pa:c.style.width=d.siblings().length?d.width():"auto",c.style.height=d.height()||"auto";var f=Q(d,"position");c.style.position=/static/i.test(f)?"relative":f,d.append(e);break;case Oa:b(W.body).append(e);break;case Qa:var g=a.mask=Ya(ia);b(W.body).append(g.append(e))}e.addClass(c.css).css(c.style).append(h(a,c));var i=c.box,k=a.box=Ya(sa).addClass("{0}-layout-{0}".fill(sa,i.layout)).addClass(i.css).css(i.style);i.layout===Sa&&k.append(Ya(ja)),e.append(k),e.append(j(a,c))}function h(a,b){var c=b.header,d=a.header=Ya(ma).addClass(c.css).css(c.style).append(i(a,b));return c.render&&c.render.call(d,b.item.data),d}function i(c,d){var e=d.header.filter,f=b('<input type="text"  placeholder="{0}" class="{0}" />'.fill(e.placeholder,Aa)).addClass(e.css).css(e.style);return f.keyup(function(d){var g=f.val();U&&(a.clearTimeout(U),U=0),(/^change$/i.test(e.trigger)?""===b.trim(String.fromCharCode(d.keyCode||d.which))||f.data("last")!==g:13===d.keyCode)&&(f.data("last",g),U=Y(function(){c.filter(g,$)},e.delay))}),f}function j(a,b){var c=b.footer,d=a.footer=Ya(na).addClass(c.css).css(c.style),e=Ya(oa),f=Ya(pa);return f.append(Ya(qa,Ia).html(c.totalTpl.replace(Na,0))),d.append(e).append(f),b.result.multi&&k(a,b,e,f),c.render&&c.render.call(d,b.data),d}function k(a,c,d,e){var f=b(Ja);d.append(b("<label>").append(f).append("全选")),f.change(function(){var c=f.is(":checked");I(a,Ha).each(function(d,e){if(e=b(e),c){if(e.hasClass(ya))return;return void E(a,e,$)}e.hasClass(ya)&&F(a,e,$)})});var g=Ya(ra,Ia);K(c,g),e.prepend(g)}function l(a,c){var d=c.valueField,e=c.textField||d,f=[{_group_item_:$,text:c.unknown,id:0}],g={},h=0;b.each(a,function(){var a=this,b=Va(a,d),c=Va(a,e);if(!b)return a._group_id_=0,void f.push(a);var i=a[d],j=c?a[e]:"";Va(g,i)||(g[i]={id:++h,text:j,data:[]}),a._group_id_=h,g[i].data.push(a)});var i=[];return b.each(g,function(a,b){i.push({id:b.id,_group_item_:$,key:a,text:b.text}),Za(i,b.data)}),f.length>1&&Za(i,f),i}function m(a,b){var d=a.box,e=a.option,f=e.item,g=f.data,h=e.group,i=Z(f.visible);(isNaN(i)||i<0)&&(i=0);var j=g?g.length:0;d.height("auto"),e.box.layout===Sa?d.find(c.build(ja).first()).empty():d.empty(),C(a),a.dom.removeClass(la);var k=G(a);if(N(k,j),J(e,k),!j)return d.append(e.box.empty),a.dom.addClass(la),void(b&&b.call(a,g));h.valueField&&(g=l(g,h),j=g.length);var m=n(a,d,f,g,b,0,i);if(isNaN(Z(a.dom.get(0).style.height))){S(a);var o=P(m).height;T(a);var p=0;if(h.valueField){var q=d.find(c.build(ta));p=q.first().height()*q.length}if(0===i||i>=j)return void d.height(j*o+p);d.height(i*o+p)}else{var r=a.dom.height();if(a.header.is(Ha)&&(r-=a.header.height()),a.footer.is(Ha)&&(r-=a.footer.height()),d.height(r),0===i||i>=j)return}f.async?Wa(n,[a,d,f,g,b,i]):n(a,d,f,g,b,0)}function n(a,b,d,e,f,g,h){var i;a.option.box.layout===Sa&&(b=b.find(c.build(ja).first()));var j=a.option.group,k=d.data;if(h=h||e.length-g,!(g>=e.length)){var l=g+h;l>e.length&&(l=e.length);for(var m,n=j.valueField,o=g;o<l;o++){var p=e[o];if(n&&p._group_item_){var q=Ya(ta).addClass(j.css).css(j.style).html(p.text).attr(Ma,p.id);j.render&&q.append(j.render.call(a,q,p)),b.append(q),m=aa}else{m||(m=Ya(ka),b.append(m));var r=N(Ya(ua),p),s=Ya(va),t=Ya(wa),u=Ya(xa);r.addClass(d.css).css(d.style).append(s).append(t).append(u),t.append(d.render?d.render.call(r,p,o,k):p[d.textField]),r.attr(La,o),n&&r.attr(Ma,p._group_id_),m.append(r),i||(i=r)}}return l!==e.length?i:(d.value&&a.value(d.value,$),f&&f.call(a,k),i)}}function o(c){c.option.mode!==Pa&&(p(c),s(c)),t(c),u(c),c.option.keyboard&&v(c),b(a).resize(function(){c.dom.is(Ha)&&(q(c.context,c.dom,c.option),r(c))})}function p(a){var b=a.context,c=a.dom;b.click(function(d){a.option.readonly||(b.is(d.target)||0!==b.find(d.target).length)&&(c.is(Ha)||a.show())})}function q(c,d,e){var f=c.offset(),g=e.mode,h=d.height(),i=b(a).height(),j=P(c),k=j.height,l=j.width;g===Oa?(i-f.top-k<h?f.top=f.top-h-2:f.top=f.top+k+2,d.css({left:f.left,top:f.top,width:e.style.width||l})):g===Qa&&d.parent().css({paddingTop:(i-h)/3,paddingLeft:(b(a).width()-d.width())/2})}function r(a){var b=a.dom,c=b.parent().height();(a.option.mode===Pa||b.height()>=c)&&b.height(c);var d=b.get(0).style.height;d&&!/auto/i.test(d)&&a.box.height(b.height()-8-(a.header.is(Ha)?a.header.height():0)-(a.footer.is(Ha)?a.footer.height():0))}function s(c){var d=c.context,e=c.dom;b(a).click(function(a){var b=a.target;d.is(b)||e.is(b)||d.find(b).length||e.find(b).length||e.is(Ha)&&c.hide()})}function t(a){a.box.on("click",c.build(ua).done(),function(){var c=b(this);D(a,c,$,$),a.fromSelect&&a.option.result.sync&&a.source.val(a.value()),a.option.result.multi||a.hide()})}function u(a){var b=a.context.find(c.build(ea).first()),d=H(a),e=a.option,f=e.result,g=f.multi,h=f.render;a.on(Ea,function(c){var f=c.data[e.item.textField];if(f=h?h.call(c.target,c.data):f,!g)return void b.html(f);if(e.mode!==Pa){var i=x(a,f,c.index);b.append(i),b.stop().animate({scrollTop:b[0].scrollHeight})}N(d,(M(d)||0)+1),K(e,d)}),g&&a.on(Fa,function(a){b.find(c.build(Ba).attr(La,a.index).first()).remove(),N(d,M(d)-1),K(e,d)})}function v(d){b(a).keydown(function(a){if(d.dom.is(Ha)){var b,e=d.box.find(c.build(za).first()),f=a.keyCode||a.which;if(40===f)0===e.length?b=I(d).eq(0):(b=e.next(),b.length||(b=e.parent().nextAll(c.build(ka).first()).find(c.build(ua).first())));else{if(38!==f)return void(32===f?e.click():27===f&&d.hide());0===e.length?b=I(d).eq(0):(b=e.prev(),b.length||(b=e.parent().prevAll(c.build(ka).first()).find(c.build(ua).last())))}b.length||(b=e),d.header.find("."+Aa).blur(),b.focus(),e.removeClass(za),b.addClass(za),w(b)}}),d.dom.on("mouseover",c.build(ua).done(),function(){d.box.find("."+za).removeClass(za),b(this).addClass(za)})}function w(a){var b=a.parent().parent();/auto/i.test(Q(b,"overflowY"))||(b=b.parent()),b.stop().animate({scrollTop:a.offset().top-b.offset().top+b.scrollTop()},100)}function x(a,b,d){if(a.option.mode!==Pa)return Ya(Ba).css(a.option.result.style).attr(La,d).append(Ya(Ca,Ia).html(b)).append(Ya(Da,Ia).click(function(){if(!a.option.readonly)return F(a,I(a,c.build().attr(La,d).first()),$),_}))}function y(a,b,c){z(a,b,{target:c.get(0),data:M(c),index:c.attr(La)})}function z(a,b,c){Va(a.events,b)&&(c.type=b,a.events[b].forEach(function(b){b.call(a,c)}))}function A(a){var d=a.option.item.valueField;if(!a.option.result.multi){var e=I(a,c.build(ya).first());return 0===e.length?void 0:M(e)[d]}return b.makeArray(I(a,c.build(ya).done()).map(function(a,c){return M(b(c))[d]}))}function B(a,c,d){for(var e,f=b.makeArray(c),g=0,h=I(a);g<h.length;g++){e=b(h[g]);if(-1!==f.indexOf(M(e)[a.option.item.valueField])&&(D(a,e,_,d),!a.option.result.multi))return}}function C(a){var d=I(a);if(a.context.find(c.build(ea).first()).empty(),a.option.result.multi)return void d.filter(c.build(ya).done()).each(function(c,d){F(a,b(d),$)});var e=d.filter(c.build(ya).first());e.length&&F(a,e,$)}function D(a,b,d,e){var f=a.option.result.multi,g=b.hasClass(ya);if(!f){if(g)return;var h=a.box.find(c.build(ya).done()).not(b).first();return h.length&&F(a,h,e),void E(a,b,e)}if(!g)return void E(a,b,e);d&&F(a,b,e)}function E(a,b,c){b.addClass(ya),c&&y(a,Ea,b)}function F(a,b,c){b.removeClass(ya),c&&y(a,Fa,b)}function G(a){return a.footer.find(c.build(pa).sub(qa).done())}function H(a){return a.footer.find(c.build(pa).sub(ra).done())}function I(a,b){return a.box.find(c.build(ua).addon(b).done())}function J(a,b){L(b,a.footer.totalTpl)}function K(a,b){L(b,a.footer.selectedTpl)}function L(a,b){a.html(b.replace(Na,M(a)||0))}function M(a){return a.data(Ka)}function N(a,b){return a.data(Ka,b)}function O(a,b,d){var e=a.filter(c.build().attr(Ma,d).done());0===b.filter(c.build().attr(Ma,d).visible()).length?e.hide():e.show()}function P(a){var b=a.width(),c=a.height(),d=R(a);return/^border-box$/i.test(Q(a,"box-sizing"))&&(c+=d.top+d.bottom,b+=d.left+d.right),{width:b,height:c}}function Q(a,b){return a.css(b)}function R(a){return{top:Z(Q(a,"padding-top"))||0,right:Z(Q(a,"padding-right"))||0,bottom:Z(Q(a,"padding-bottom"))||0,left:Z(Q(a,"padding-left"))||0}}function S(a){a.dom.css({display:"block",visibility:"hidden"})}function T(a){a.dom.css({display:"none",visibility:"visible"})}String.prototype.fill=function(){var a=[].slice.apply(arguments);return this.replace(/{([0-9]+)(\/.[lLrR]?)?}/g,function(b,c,d){var e=a.length?a.shift():"";if(e=null===e||void 0===e?"":String(e).toString(),0===c)return e;var f=c-e.length;if(f<=0)return e;for(var g=d[1],h=d[2]||"l",i="",j=0;j<f;j++)i+=g;return/r/i.test(h)?e+=i:e=i+e,e})};var U,V=[],W=a.document,X=a.console,Y=a.setTimeout,Z=a.parseInt,$=!0,_=!1,aa=null,ba="tinyselect",ca=ba+"-context",da=ca+"-with-arrow",ea=ca+"-result",fa=ca+"-arrow",ga=ca+"-readonly",ha=ba+"-container",ia=ba+"-mask",ja=ba+"-scroll-proxy",ka=ba+"-group-content",la=ha+"-empty",ma=ba+"-header",na=ba+"-footer",oa=na+"-left",pa=na+"-right",qa=ba+"-count-total",ra=ba+"-count-selected",sa=ba+"-box",ta=ba+"-group",ua=ba+"-item",va=ba+"-item-before",wa=ba+"-item-text",xa=ba+"-item-after",ya=ua+"-selected",za=ua+"-hover",Aa=ba+"-filter",Ba=ba+"-result-item",Ca=Ba+"-text",Da=Ba+"-link",Ea="select",Fa="unselect",Ga=[Ea,Fa,"ready"],Ha=":visible",Ia="span",Ja='<input type="checkbox" style="vertical-align:-2px;" class="'+ba+'-selectall" />',Ka="data",La="data-tiny-index",Ma="data-tiny-group",Na="%s",Oa="dropdown",Pa="list",Qa="popup",Ra=[Oa,Pa,Qa],Sa="table",Ta=["list","grid",Sa],Ua={readonly:_,mode:Oa,keyboard:$,css:aa,style:{lineHeight:"28px"},header:{render:_,filter:{trigger:"enter",delay:618,placeholder:"输入后按回车过滤",matchCase:_,css:aa,style:{}},css:aa,style:{}},box:{empty:"没有数据",layout:"list",css:aa,style:{}},group:{valueField:_,textField:_,unknown:"未分组",render:_,css:aa,style:{}},item:{data:[],value:_,valueField:"id",textField:"text",visible:5,render:_,async:$,css:aa,style:{}},footer:{render:_,totalTpl:"共{0}项".fill(Na),selectedTpl:"选中{0}项/".fill(Na),css:aa,style:{}},result:{multi:_,arrow:aa,render:_,sync:$,type:0,css:aa,style:{}}};c.prototype={constructor:c,css:function(a){return a&&this.selector.push("."+a),this},attr:function(a,b){return 1===arguments.length?this.selector.push("[{0}]".fill(a)):this.selector.push("[{0}={0}]".fill(a,b)),this},sub:function(a){return this.selector.push(" "),this.css(a)},visible:function(){return this.addon(Ha).done()},first:function(){return this.addon(":first").done()},last:function(){return this.addon(":last").done()},addon:function(a){return a&&this.selector.push(a),this},done:function(a){return this.css(a),this.selector.join("")}},c.build=function(a){return new c(a)};var Va=function(a,b){return!a||a.hasOwnProperty(b)},Wa=function(a,b){Y(function(){a.apply(aa,b)},0)},Xa=function(a,c){return b.extend($,b.isArray(a)?[]:{},a,c)},Ya=function(a,c){return b('<{0} class="{0}">'.fill(c||"div",a))},Za=function(a,b){Array.prototype.push.apply(a,b)};d.fn=d.prototype={constructor:d,init:function(a,c,d){var h=this;if(b.isArray(c))h.option=Xa(Ua,{item:{data:c},result:{multi:d}});else{h.option=Xa(Ua,c);var i=h.option.mode||Oa;if(-1===Ra.indexOf(i))throw new Error('Render mode "{0}" is not supported,\nhere is the valid modes: {0}'.fill(i,Ra.join()));var j=h.option.layout||"list";if(-1===Ta.indexOf(j))throw new Error('Item layout "{0}" is not supported,\nhere is the valid modes: {0}'.fill(j,Ta.join()))}return h.source=a=b(a),h.context=a.is("select")?e(h,a):a,f(h),h.events={},g(h),o(h),h.load(h.option.item.data,function(a){z(h,"ready",{data:a})}),h},on:function(a,b){var c=this;if(-1===Ga.indexOf(a))return X.warn("{0}:{0}".fill("不支持此事件类型",a)),c;var d=c.events;return Va(d,a)?d[a].push(b):d[a]=[b],c},off:function(a,b){var c=this;if(-1===Ga.indexOf(a))return c;var d=c.events;if(!Va(d,a))return c;var e=d[a],f=e.indexOf(b);return-1!==f&&e.splice(f,1),c},show:function(a){var b=this,d=b.dom,e=b.option.mode;return e===Pa?b:(e===Qa&&b.mask.show(),q(b.context,d,b.option),d.fadeIn("fast",function(){d.find(c.build(ma).sub(Aa).visible()).focus(),r(b),a&&a.call(b)}),b)},hide:function(a){var b=this,c=b.option.mode;return c===Pa?b:((c===Oa?b.dom:b.mask).fadeOut("fast",function(){a&&a.call(b)}),b)},filter:function(a,d){function e(a){if(i){var c=b(a).attr(Ma),d=l[c];++d.handled<d.total||O(k,j,c)}}var f=this,g=[],h=b.isFunction(a),i=!!f.option.group.valueField,j=I(f),k=f.dom.find(c.build(ta).done()),l={};return k.each(function(){var a=b(this).attr(Ma);l[a]={total:j.filter(c.build(ua).attr(Ma,a).done()).length,handled:0}}),j.each(function(c,i){i=b(i);var j=M(i);(h?a.call(this,j):f.option.header.filter.matchCase?-1!==i.text().indexOf(a.toString()):-1!==i.text().toLowerCase().indexOf(a.toString().toLowerCase()))?(g.push({item:i,data:j}),d&&i.slideDown(50,function(){e(this)})):d&&i.slideUp(50,function(){e(this)})}),g},value:function(a,b){var c=this;return 0===arguments.length?A(c):(B(c,a,b),c)},clear:function(){return C(this),this},load:function(a,b){var c=this;return c.option.item.data=Xa(a),m(c,function(){r(c),b&&b.call(c,c.option.item.data)}),c},readonly:function(a){var b=this;return 0===arguments.length?b.option.readonly:(a?(b.hide(),b.context.addClass(ga)):b.context.removeClass(ga),b.option.readonly=a,b)}},d.fn.init.prototype=d.fn,d.defaults=Ua,a.tinyselect=d}(window,jQuery);
//# sourceMappingURL=tinyselect.js.map